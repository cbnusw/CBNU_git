(this.webpackJsonp=this.webpackJsonp||[]).push([[142,10],{113:function(e,t,n){"use strict";n.r(t);var i=n(88),o=n(70),s=n(96);document.addEventListener("DOMContentLoaded",(function(){Object(s.a)(document,gon),new i.a,new o.a}))},1134:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var i=n(0),o=n.n(i),s=n(14),r=n(11),a=n(1);function c(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var l=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.container=t.container||"",this.dropdownListSelector=".js-builds-dropdown-container",this.getBuildsList=this.getBuildsList.bind(this)}var t,n,i;return t=e,(n=[{key:"bindEvents",value:function(){o()(document).off("shown.bs.dropdown",this.container).on("shown.bs.dropdown",this.container,this.getBuildsList)}},{key:"stopDropdownClickPropagation",value:function(){o()(document).on("click","".concat(this.container," .js-builds-dropdown-list a.mini-pipeline-graph-dropdown-item"),(function(e){e.stopPropagation()}))}},{key:"renderBuildsList",value:function(e,t){e.parentElement.querySelector("".concat(this.dropdownListSelector," .js-builds-dropdown-list ul")).innerHTML=t}},{key:"getBuildsList",value:function(e){var t=this,n=e.relatedTarget,i=n.dataset.stageEndpoint;this.renderBuildsList(n,""),this.toggleLoading(n),r.a.get(i).then((function(e){var i=e.data;t.toggleLoading(n),t.renderBuildsList(n,i.html),t.stopDropdownClickPropagation()})).catch((function(){t.toggleLoading(n),o()(n).parent().hasClass("open")&&o()(n).dropdown("toggle"),Object(s.a)(Object(a.a)("An error occurred while fetching the builds."),"alert")}))}},{key:"toggleLoading",value:function(e){e.parentElement.querySelector("".concat(this.dropdownListSelector," .js-builds-dropdown-loading")).classList.toggle("hidden")}}])&&c(t.prototype,n),i&&c(t,i),e}()},1386:function(e,t,n){"use strict";var i=n(804);document.addEventListener("DOMContentLoaded",i.a)},184:function(e,t,n){var i=n(108),o=n(271),s=n(215),r=n(296),a=n(344),c=n(419);i({target:"Reflect",stat:!0},{get:function e(t,n){var i,l,u=arguments.length<3?t:arguments[2];return s(t)===u?t[n]:(i=a.f(t,n))?r(i,"value")?i.value:void 0===i.get?void 0:i.get.call(u):o(l=c(t))?e(l,n,u):void 0}})},208:function(e,t,n){"use strict";n.d(t,"a",(function(){return j}));n(42),n(26),n(77),n(38),n(27);var i=n(0),o=n.n(i),s=n(157),r=n.n(s),a=n(164),c=(n(28),n(85),n(46),n(55),n(91),n(67),n(233),n(94)),l=n.n(c),u=n(20),d=n.n(u);n(441),n(24),n(49),n(56),n(78),n(104),n(40),n(65),n(145),n(18),n(68),n(122),n(36),n(89),n(41);function f(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function h(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var p=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.data=t,this.columnWidths=[],this.rows=[],this.tableFound=this.parseTable()}var t,n,i;return t=e,(n=[{key:"isTable",value:function(){return this.tableFound}},{key:"convertToTableMarkdown",value:function(){var e=this;this.calculateColumnWidths();var t=this.rows.map((function(t){return"| ".concat(t.map((function(t,n){return e.formatColumn(t,n)})).join(" | ")," |")}));return t.splice(1,0,this.generateHeaderBreak()),t.join("\n")}},{key:"parseTable",value:function(){if(!this.data.types.includes("text/html")||!this.data.types.includes("text/plain"))return!1;var e=this.data.getData("text/html");if(this.doc=(new DOMParser).parseFromString(e,"text/html"),1!==this.doc.querySelectorAll("table").length)return!1;var t=this.data.getData("text/plain").trim().split(/[\n\u0085\u2028\u2029]|\r\n?/g);return this.doc.querySelectorAll("tr").length===t.length&&(this.rows=t.map((function(e){return e.split("\t")})),this.normalizeRows(),!!this.columnCountsMatch())}},{key:"normalizeRows",value:function(){var e=this.rows.map((function(e){return e.length})),t=Math.max.apply(Math,h(e));this.rows.forEach((function(e){for(;e.length<t;)e.push("")}))}},{key:"calculateColumnWidths",value:function(){var e=this;this.columnWidths=this.rows[0].map((function(t,n){return function(e,t){return Math.max.apply(Math,h(e.map((function(e){return e[t].length}))))}(e.rows,n)}))}},{key:"columnCountsMatch",value:function(){var e=this.rows[0].length,t=0;return this.doc.querySelectorAll("table tr").forEach((function(e){t=Math.max(e.cells.length,t)})),e===t}},{key:"formatColumn",value:function(e,t){return e+Array(this.columnWidths[t]-e.length+1).join(" ")}},{key:"generateHeaderBreak",value:function(){var e=this,t=this.columnWidths.map((function(t,n){return Array(e.columnWidths[n]+3).join("-")}));return"|".concat(t.join("|"),"|")}}])&&f(t.prototype,n),i&&f(t,i),e}(),v=n(178),m=n(11),g=n(1);function y(e){return!e||d.a.isString(e)?e:e.message}function b(e){var t,n,i,s,r,a,c,u=e.find(".button-attach-file"),f=e.find(".attaching-file-message"),h=e.find(".button-cancel-uploading-files"),b=e.find(".retry-uploading-link"),w=e.find(".uploading-progress"),k=e.find(".uploading-error-container"),j=e.find(".uploading-error-message"),C=e.find(".uploading-progress-container"),E=e.data("uploads-path")||window.uploads_path||null,_=gon.max_file_size||10,S=e.find(".js-gfm-input");S.wrap('<div class="div-dropzone"></div>'),S.on("paste",(function(e){return t(e)}));var T=S.closest(".md-area");e.setupMarkdownPreview();var x=e.find(".div-dropzone");if(x.parent().addClass("div-dropzone-wrapper"),x.append('<div class="div-dropzone-hover"></div>'),x.find(".div-dropzone-hover").append('<i class="fa fa-paperclip div-dropzone-icon"></i>'),!E)return x.addClass("js-invalid-dropzone"),null;var I=x.dropzone({url:E,dictDefaultMessage:"",clickable:!0,paramName:"file",maxFilesize:_,uploadMultiple:!1,headers:v.a.headers,previewContainer:!1,processing:function(){return o()(".div-dropzone-alert").alert("close")},dragover:function(){T.addClass("is-dropzone-hover"),e.find(".div-dropzone-hover").css("opacity",.7)},dragleave:function(){T.removeClass("is-dropzone-hover"),e.find(".div-dropzone-hover").css("opacity",0)},drop:function(){T.removeClass("is-dropzone-hover"),e.find(".div-dropzone-hover").css("opacity",0),S.focus()},success:function(e,t){var o=this.getQueuedFiles().length+this.getUploadingFiles().length,s=o>=1;n(t.link.markdown,s),o||u.removeClass("hide"),i(t.link.url)},error:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(g.a)("Attaching the file failed."),n=arguments.length>2?arguments[2]:void 0,i=y(t||n.responseText);k.removeClass("hide"),j.html(i),u.addClass("hide"),h.addClass("hide")},totaluploadprogress:function(e){s(this.files,f),w.text("".concat(Math.round(e),"%"))},sending:function(){u.addClass("hide"),k.addClass("hide"),C.removeClass("hide"),h.removeClass("hide")},removedfile:function(){u.removeClass("hide"),h.addClass("hide"),C.addClass("hide"),k.addClass("hide")},queuecomplete:function(){o()(".dz-preview").remove(),o()(".markdown-area").trigger("input"),C.addClass("hide"),h.addClass("hide")}}),N=o()(I[0]).children("textarea");h.on("click",(function(e){e.preventDefault(),e.stopPropagation(),l.a.forElement(x.get(0)).removeAllFiles(!0)})),b.on("click",(function(e){var t=l.a.forElement(e.target.closest(".js-main-target-form").querySelector(".div-dropzone")),n=t.files;e.preventDefault(),t.removeAllFiles(!0),n.map((function(e){var n=e;return n.status===l.a.ERROR&&(n.status=void 0,n.accepted=void 0),t.addFile(n)}))})),t=function(e){var t=e.originalEvent,i=t.clipboardData;if(i&&i.items){var o=new p(i);if(o.isTable()){e.preventDefault();var s=o.convertToTableMarkdown();n(s)}else{var l=r(t);if(l){e.preventDefault();var u=a(t)||"image.png",d="{{".concat(u,"}}");return n(d),c(l.getAsFile(),u)}}}},r=function(e){for(var t=0;t<e.clipboardData.items.length;){var n=e.clipboardData.items[t];if(-1!==n.type.indexOf("image"))return n;t+=1}return!1},n=function(e,t){var n=e;t&&(n+="\n\n");var i=N.get(0),s=i.selectionStart,r=i.selectionEnd,a=o()(N).val().length,c=o()(N).val().substring(0,s),l=o()(N).val().substring(r,a);return o()(N).val(c+n+l),i.setSelectionRange(s+n.length,r+n.length),i.style.height="".concat(i.scrollHeight,"px"),S.get(0).dispatchEvent(new Event("input")),S.trigger("input")},i=function(t){o()(e).append('<input type="hidden" name="files[]" value="'.concat(d.a.escape(t),'">'))},a=function(e){var t;return window.clipboardData&&window.clipboardData.getData?t=window.clipboardData.getData("Text"):e.clipboardData&&e.clipboardData.getData&&(t=e.clipboardData.getData("text/plain")),(t=t.split("\r"))[0]};var O=function(){return C.addClass("hide")};return c=function(t,n){var i=new FormData;i.append("file",t,n),C.removeClass("hide"),e.find(".div-dropzone-alert").alert("close"),m.a.post(E,i).then((function(e){var t=e.data.link.markdown;!function(e,t){var n=o()(N),i=n.get(0),s=i.selectionStart,r=i.selectionEnd,a="{{".concat(e,"}}");n.val((function(e,n){return n.replace(a,t)})),i.setSelectionRange(s-a.length+t.length,r-a.length+t.length),n.trigger("change")}(n,t),O()})).catch((function(e){var t;t=e.response.data.message,k.removeClass("hide"),j.html(t),O()}))},s=function(e,t){var n=e.filter((function(e){return"uploading"===e.status||"queued"===e.status})).length,i=Object(g.c)("Attaching a file","Attaching %d files",n);t.text("".concat(i," -"))},e.find(".markdown-selector").click((function(e){e.preventDefault(),o()(this).closest(".gfm-form").find(".div-dropzone").click(),S.focus()})),x.get(0)?l.a.forElement(x.get(0)):null}l.a.autoDiscover=!1;var w=n(199);function k(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var j=function(){function e(t){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.form=t,this.textarea=this.form.find("textarea.js-gfm-input"),this.enableGFM=Object.assign({},a.b,i);var o=gl.GfmAutoComplete&&gl.GfmAutoComplete.dataSources||{};Object.keys(this.enableGFM).forEach((function(e){"emojis"!==e&&(n.enableGFM[e]=Boolean(o[e]))})),this.destroy(),this.setupForm(),this.form.data("glForm",this)}var t,n,i;return t=e,(n=[{key:"destroy",value:function(){this.clearEventListeners(),this.autoComplete&&this.autoComplete.destroy(),this.form.data("glForm",null)}},{key:"setupForm",value:function(){var e=this.form.is(":not(.gfm-form)");this.form.removeClass("js-new-note-form"),e&&(this.form.find(".div-dropzone").remove(),this.form.addClass("gfm-form"),gl.utils.disableButtonIfEmptyField(this.form.find(".js-note-text"),this.form.find(".js-comment-button, .js-note-new-discussion")),this.autoComplete=new a.a(gl.GfmAutoComplete&&gl.GfmAutoComplete.dataSources),this.autoComplete.setup(this.form.find(".js-gfm-input"),this.enableGFM),b(this.form),r()(this.textarea)),this.addEventListeners(),Object(w.b)(this.form),this.form.show(),this.isAutosizeable&&this.setupAutosize()}},{key:"setupAutosize",value:function(){var e=this;this.textarea.off("autosize:resized").on("autosize:resized",this.setHeightData.bind(this)),this.textarea.off("mouseup.autosize").on("mouseup.autosize",this.destroyAutosize.bind(this)),setTimeout((function(){r()(e.textarea),e.textarea.css("resize","vertical")}),0)}},{key:"setHeightData",value:function(){this.textarea.data("height",this.textarea.outerHeight())}},{key:"destroyAutosize",value:function(){var e=this.textarea.outerHeight();this.textarea.data("height")!==e&&(r.a.destroy(this.textarea),this.textarea.data("height",e),this.textarea.outerHeight(e),this.textarea.css("max-height",window.outerHeight))}},{key:"clearEventListeners",value:function(){this.textarea.off("focus"),this.textarea.off("blur"),Object(w.c)(this.form)}},{key:"addEventListeners",value:function(){this.textarea.on("focus",(function(){o()(this).closest(".md-area").addClass("is-focused")})),this.textarea.on("blur",(function(){o()(this).closest(".md-area").removeClass("is-focused")}))}}])&&k(t.prototype,n),i&&k(t,i),e}()},218:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));n(42);var i=n(0),o=n.n(i),s=(n(439),n(94)),r=n.n(s),a=n(8),c=n.n(a);n(440);function l(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}r.a.autoDiscover=!1;var u=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.active_backdrop=null,this.active_textarea=null,o()(document).on("click",".js-zen-enter",(function(e){return e.preventDefault(),o()(e.currentTarget).trigger("zen_mode:enter")})),o()(document).on("click",".js-zen-leave",(function(e){return e.preventDefault(),o()(e.currentTarget).trigger("zen_mode:leave")})),o()(document).on("zen_mode:enter",(function(e){t.enter(o()(e.target).closest(".md-area").find(".zen-backdrop"))})),o()(document).on("zen_mode:leave",(function(){t.exit()})),o()(document).on("keydown",(function(e){if(27===e.keyCode)return e.preventDefault(),o()(document).trigger("zen_mode:leave")}))}var t,n,i;return t=e,(n=[{key:"enter",value:function(e){c.a.pause(),this.active_backdrop=o()(e),this.active_backdrop.addClass("fullscreen"),this.active_textarea=this.active_backdrop.find("textarea"),this.active_textarea.removeAttr("style"),this.active_textarea.focus()}},{key:"exit",value:function(){if(this.active_textarea){c.a.unpause(),this.active_textarea.closest(".zen-backdrop").removeClass("fullscreen"),this.scrollTo(this.active_textarea),this.active_textarea=null,this.active_backdrop=null;var e=o()(".div-dropzone");e&&!e.hasClass("js-invalid-dropzone")&&r.a.forElement(".div-dropzone").enable()}}},{key:"scrollTo",value:function(e){return o.a.scrollTo(e,0,{offset:-150})}}])&&l(t.prototype,n),i&&l(t,i),e}()},2280:function(e,t,n){n(105),n(113),e.exports=n(2469)},2281:function(e,t){window.NoteModel=function e(t,n){"use strict";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.discussionId=t,this.id=n.noteId,this.canResolve=n.canResolve,this.resolved=n.resolved,this.resolved_by=n.resolvedBy,this.authorName=n.authorName,this.authorAvatar=n.authorAvatar,this.noteTruncated=n.noteTruncated}},233:function(e,t,n){"use strict";var i=n(108),o=n(348);i({target:"String",proto:!0,forced:n(349)("link")},{link:function(e){return o(this,"a","href",e)}})},2469:function(e,t,n){"use strict";n.r(t);var i=n(0),o=n.n(i),s=n(501),r=n(218),a=n(70),c=n(1134),l=n(761),u=n(722),d=(n(28),n(17)),f=(n(38),n(62));function h(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var p=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=t,this.notes={},this.loading=!1,this.canResolve=!1}var t,n,i;return t=e,(n=[{key:"createNote",value:function(e){d.default.set(this.notes,e.noteId,new NoteModel(this.id,e))}},{key:"deleteNote",value:function(e){d.default.delete(this.notes,e)}},{key:"getNote",value:function(e){return this.notes[e]}},{key:"notesCount",value:function(){return Object.keys(this.notes).length}},{key:"isResolved",value:function(){for(var e in this.notes)if(!this.notes[e].resolved)return!1;return!0}},{key:"resolveAllNotes",value:function(e){for(var t in this.notes){var n=this.notes[t];n.resolved||(n.resolved=!0,n.resolved_by=e)}}},{key:"unResolveAllNotes",value:function(){for(var e in this.notes){var t=this.notes[e];t.resolved&&(t.resolved=!1,t.resolved_by=null)}}},{key:"updateHeadline",value:function(e){var t='.discussion[data-discussion-id="'.concat(this.id,'"]'),n=o()("".concat(t," .js-discussion-headline"));e.discussion_headline_html?(n.length?n.replaceWith(e.discussion_headline_html):o()("".concat(t," .discussion-header")).append(e.discussion_headline_html),Object(f.l)(o()(".js-timeago","".concat(t)))):n.remove()}},{key:"isResolvable",value:function(){if(!this.canResolve)return!1;for(var e in this.notes)if(this.notes[e].canResolve)return!0;return!1}}])&&h(t.prototype,n),i&&h(t,i),e}();window.DiscussionModel=p;n(2281);window.CommentsStore={state:{},get:function(e,t){return this.state[e].getNote(t)},createDiscussion:function(e,t){var n=this.state[e];return this.state[e]||(n=new DiscussionModel(e),d.default.set(this.state,e,n)),void 0!==t&&(n.canResolve=t),n},create:function(e){this.createDiscussion(e.discussionId).createNote(e)},update:function(e,t,n,i){var o=this.state[e].getNote(t);o.resolved=n,o.resolved_by=i},delete:function(e,t){var n=this.state[e];n.deleteNote(t),0===n.notesCount()&&d.default.delete(this.state,e)},unresolvedDiscussionIds:function(){var e=[];for(var t in this.state){var n=this.state[t];n.isResolved()||e.push(n.id)}return e}};var v=n(14),m=n(1);function g(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}window.gl=window.gl||{};var y=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.noteResource=d.default.resource("".concat(t,"/notes{/noteId}/resolve?html=true")),this.discussionResource=d.default.resource("".concat(t,"/merge_requests{/mergeRequestId}/discussions{/discussionId}/resolve?html=true"))}var t,n,i;return t=e,(n=[{key:"resolve",value:function(e){return this.noteResource.save({noteId:e},{})}},{key:"unresolve",value:function(e){return this.noteResource.delete({noteId:e},{})}},{key:"toggleResolveForDiscussion",value:function(e,t){var n=CommentsStore.state[t],i=n.isResolved();(i?this.unResolveAll(e,t):this.resolveAll(e,t)).then((function(e){return e.json()})).then((function(e){n.loading=!1;var t=e?e.resolved_by:null;i?n.unResolveAllNotes():n.resolveAllNotes(t),gl.mrWidget&&gl.mrWidget.checkStatus(),n.updateHeadline(e)})).catch((function(){return new v.a(Object(m.a)("An error occurred when trying to resolve a discussion. Please try again."))}))}},{key:"resolveAll",value:function(e,t){return CommentsStore.state[t].loading=!0,this.discussionResource.save({mergeRequestId:e,discussionId:t},{})}},{key:"unResolveAll",value:function(e,t){return CommentsStore.state[t].loading=!0,this.discussionResource.delete({mergeRequestId:e,discussionId:t},{})}}])&&g(t.prototype,n),i&&g(t,i),e}();gl.DiffNotesResolveServiceClass=y;var b={computed:{discussionCount:function(){return Object.keys(this.discussions).length},resolvedDiscussionCount:function(){var e=0;for(var t in this.discussions){this.discussions[t].isResolved()&&(e+=1)}return e},unresolvedDiscussionCount:function(){var e=0;for(var t in this.discussions){this.discussions[t].isResolved()||(e+=1)}return e}}},w=d.default.extend({props:{discussionId:{type:String,required:!0}},data:function(){return{textareaIsEmpty:!0,discussion:{}}},computed:{showButton:function(){return!!this.discussion&&this.discussion.isResolvable()},isDiscussionResolved:function(){return this.discussion.isResolved()},buttonText:function(){return this.isDiscussionResolved?this.textareaIsEmpty?Object(m.a)("Unresolve thread"):Object(m.a)("Comment & unresolve thread"):this.textareaIsEmpty?Object(m.a)("Resolve thread"):Object(m.a)("Comment & resolve thread")}},created:function(){this.discussionId&&(this.discussion=CommentsStore.state[this.discussionId])},mounted:function(){var e=this;if(this.discussionId){var t=o()(".js-discussion-note-form[data-discussion-id=".concat(this.discussionId,"] .note-textarea"));this.textareaIsEmpty=""===t.val(),t.on("input.comment-and-resolve-btn",(function(){e.textareaIsEmpty=""===t.val()}))}},destroyed:function(){this.discussionId&&o()(".js-discussion-note-form[data-discussion-id=".concat(this.discussionId,"] .note-textarea")).off("input.comment-and-resolve-btn")}});d.default.component("comment-and-resolve-btn",w);n(30),n(42),n(46);var k=d.default.extend({mixins:[b],props:{discussionId:{type:String,required:!0}},data:function(){return{discussions:CommentsStore.state,discussion:{}}},computed:{buttonText:function(){return this.discussionId?Object(m.a)("Jump to next unresolved thread"):Object(m.a)("Jump to first unresolved thread")},allResolved:function(){return 0===this.unresolvedDiscussionCount},showButton:function(){return this.discussionId?this.unresolvedDiscussionCount>1||this.discussionId!==this.lastResolvedId:this.unresolvedDiscussionCount>=1},lastResolvedId:function(){var e;for(var t in this.discussions){var n=this.discussions[t];n.isResolved()||(e=n.id)}return e}},created:function(){this.discussion=this.discussions[this.discussionId]},methods:{jumpToNextUnresolvedDiscussion:function(){var e,t,n,i,s=window.mrTabs.currentAction,r=!0,a=!this.discussionId,c=function(e){return e.map((function(){return o()(this).attr("data-discussion-id")})).toArray()},l=this.discussions;if("diffs"===s){e=".diffs .notes[data-discussion-id]",t=c(o()(e));for(var u=0,d=0;d<t.length;d+=1){var f=l[t[d]];f&&!f.isResolved()&&(u+=1)}this.discussionId&&!this.discussion.isResolved()?1===u&&(r=!1):0===u&&(r=!1)}else"show"!==s&&(r=!1);r||(window.mrTabs.activateTab("show"),s="show",a=!0),"show"===s&&(e=".discussion[data-discussion-id]",t=c(o()(e)));for(var h=!1,p=0;p<t.length;p+=1){var v=t[p],m=l[v];if(m){if(!n&&!m.isResolved()&&(n=v,a))break;if(!a){if(h){if(m.isResolved())continue;i=v;break}v===this.discussionId&&(h=!0)}}}if(i=i||n){var g=o()("".concat(e,'[data-discussion-id="').concat(i,'"]'));if("show"===s)(g=g.closest(".note-discussion")).find(".js-toggle-content").is(":hidden")&&g.find(".js-toggle-button i").trigger("click");else if("diffs"===s){g.closest(".content").show();var y,b=g.closest("tr.notes_holder");b.length>0&&(g=b),g.show();for(var w=0;w<4&&(y=g.prev()).hasClass("line_holder");w+=1)g=y}o.a.scrollTo(g,{offset:-150})}}}});d.default.component("jump-to-discussion",k);n(72);var j=d.default.extend({props:{noteId:{type:Number,required:!0},discussionId:{type:String,required:!0},resolved:{type:Boolean,required:!0},canResolve:{type:Boolean,required:!0},resolvedBy:{type:String,required:!0},authorName:{type:String,required:!0},authorAvatar:{type:String,required:!0},noteTruncated:{type:String,required:!0}},data:function(){return{discussions:CommentsStore.state,loading:!1}},computed:{discussion:function(){return this.discussions[this.discussionId]},note:function(){return this.discussion?this.discussion.getNote(this.noteId):{}},buttonText:function(){return this.isResolved?Object(m.e)(Object(m.a)("Resolved by %{resolvedByName}"),{resolvedByName:this.resolvedByName}):this.canResolve?Object(m.a)("Mark as resolved"):Object(m.a)("Unable to resolve")},isResolved:function(){return!!this.note&&this.note.resolved},resolvedByName:function(){return this.note.resolved_by}},watch:{discussions:{handler:"updateTooltip",deep:!0}},mounted:function(){o()(this.$refs.button).tooltip({container:"body"})},beforeDestroy:function(){CommentsStore.delete(this.discussionId,this.noteId)},created:function(){CommentsStore.create({discussionId:this.discussionId,noteId:this.noteId,canResolve:this.canResolve,resolved:this.resolved,resolvedBy:this.resolvedBy,authorName:this.authorName,authorAvatar:this.authorAvatar,noteTruncated:this.noteTruncated})},methods:{updateTooltip:function(){var e=this;this.$nextTick((function(){o()(e.$refs.button).tooltip("hide").tooltip("_fixTitle")}))},resolve:function(){var e=this;this.canResolve&&(this.loading=!0,(this.isResolved?ResolveService.unresolve(this.noteId):ResolveService.resolve(this.noteId)).then((function(e){return e.json()})).then((function(t){e.loading=!1;var n=t?t.resolved_by:null;CommentsStore.update(e.discussionId,e.noteId,!e.isResolved,n),e.discussion.updateHeadline(t),gl.mrWidget.checkStatus(),e.updateTooltip()})).catch((function(){return new v.a(Object(m.a)("An error occurred when trying to resolve a comment. Please try again."))})))}}});d.default.component("resolve-btn",j),window.ResolveCount=d.default.extend({mixins:[b],props:{loggedOut:{type:Boolean,required:!0}},data:function(){return{discussions:CommentsStore.state}},computed:{allResolved:function(){return this.resolvedDiscussionCount===this.discussionCount},resolvedCountText:function(){return 1===this.discussionCount?"discussion":"discussions"}}});n(69);var C=n(550),E=n(236),_=d.default.extend({components:{userAvatarImage:E.a},props:{discussionId:{type:String,required:!0}},data:function(){return{isVisible:!1,lineType:"",storeState:CommentsStore.state,shownAvatars:3,collapseIcon:'<svg width="11" height="11" viewBox="0 0 9 13"><path d="M2.57568253,6.49866948 C2.50548852,6.57199715 2.44637866,6.59708255 2.39835118,6.57392645 C2.3503237,6.55077034 2.32631032,6.48902165 2.32631032,6.38867852 L2.32631032,-2.13272614 C2.32631032,-2.23306927 2.3503237,-2.29481796 2.39835118,-2.31797406 C2.44637866,-2.34113017 2.50548852,-2.31604477 2.57568253,-2.24271709 L6.51022184,1.86747129 C6.53977721,1.8983461 6.56379059,1.93500939 6.5822627,1.97746225 L6.5822627,2.27849013 C6.56379059,2.31708364 6.53977721,2.35374693 6.51022184,2.38848109 L2.57568253,6.49866948 Z" transform="translate(4.454287, 2.127976) rotate(90.000000) translate(-4.454287, -2.127976) "></path><path d="M3.74312342,2.09553332 C3.74312342,1.99519019 3.77821989,1.9083561 3.8484139,1.83502843 C3.91860791,1.76170075 4.00173115,1.72503747 4.09778611,1.72503747 L4.80711151,1.72503747 C4.90316647,1.72503747 4.98628971,1.76170075 5.05648372,1.83502843 C5.12667773,1.9083561 5.16177421,1.99519019 5.16177421,2.09553332 L5.16177421,10.2464421 C5.16177421,10.3467853 5.12667773,10.4336194 5.05648372,10.506947 C4.98628971,10.5802747 4.90316647,10.616938 4.80711151,10.616938 L4.09778611,10.616938 C4.00173115,10.616938 3.91860791,10.5802747 3.8484139,10.506947 C3.77821989,10.4336194 3.74312342,10.3467853 3.74312342,10.2464421 L3.74312342,2.09553332 Z" transform="translate(4.452449, 6.170988) rotate(-90.000000) translate(-4.452449, -6.170988) "></path><path d="M2.57568253,14.6236695 C2.50548852,14.6969971 2.44637866,14.7220826 2.39835118,14.6989264 C2.3503237,14.6757703 2.32631032,14.6140216 2.32631032,14.5136785 L2.32631032,5.99227386 C2.32631032,5.89193073 2.3503237,5.83018204 2.39835118,5.80702594 C2.44637866,5.78386983 2.50548852,5.80895523 2.57568253,5.88228291 L6.51022184,9.99247129 C6.53977721,10.0233461 6.56379059,10.0600094 6.5822627,10.1024622 L6.5822627,10.4034901 C6.56379059,10.4420836 6.53977721,10.4787469 6.51022184,10.5134811 L2.57568253,14.6236695 Z" transform="translate(4.454287, 10.252976) scale(1, -1) rotate(90.000000) translate(-4.454287, -10.252976) "></path></svg>\n'}},computed:{discussionClassName:function(){return"js-diff-avatars-".concat(this.discussionId)},notesSubset:function(){var e=this,t=[];return this.discussion&&(t=Object.keys(this.discussion.notes).slice(0,this.shownAvatars).map((function(t){return e.discussion.notes[t]}))),t},extraNotesTitle:function(){if(this.discussion){var e=this.discussion.notesCount()-this.shownAvatars;return Object(m.c)("%d more comment","%d more comments",e)}return""},discussion:function(){return this.storeState[this.discussionId]},notesCount:function(){return this.discussion?this.discussion.notesCount():0},moreText:function(){var e=this.notesCount<100?"+":"";return"".concat(e).concat(this.notesCount-this.shownAvatars)}},watch:{storeState:{handler:function(){var e=this;this.$nextTick((function(){o()(".has-tooltip",e.$el).tooltip("_fixTitle"),e.addNoCommentClass()}))},deep:!0}},mounted:function(){var e=this;this.$nextTick((function(){e.addNoCommentClass(),e.setDiscussionVisible(),e.lineType=o()(e.$el).closest(".diff-line-num").hasClass("old_line")?"old":"new"})),o()(document).on("toggle.comments",(function(){e.$nextTick((function(){e.setDiscussionVisible()}))}))},beforeDestroy:function(){this.addNoCommentClass(),o()(document).off("toggle.comments")},methods:{clickedAvatar:function(e){var t=this;C.a.instance.onAddDiffNote(e),this.toggleDiscussionsToggleState(),this.$nextTick((function(){t.setDiscussionVisible(),o()(".has-tooltip",t.$el).tooltip("_fixTitle"),o()(".has-tooltip",t.$el).tooltip("hide")}))},addNoCommentClass:function(){var e=this.notesCount;o()(this.$el).closest(".js-avatar-container").toggleClass("no-comment-btn",e>0).nextUntil(".js-avatar-container").toggleClass("no-comment-btn",e>0)},toggleDiscussionsToggleState:function(){var e=o()(this.$el).closest(".code").find(".notes_holder"),t=e.filter(":visible");o()(this.$el).closest(".diff-file").find(".js-toggle-diff-comments").toggleClass("active",e.length===t.length)},setDiscussionVisible:function(){this.isVisible=o()('.diffs .notes[data-discussion-id="'.concat(this.discussion.id,'"]')).is(":visible")},getTooltipText:function(e){return"".concat(e.authorName,": ").concat(e.noteTruncated)}},template:'\n    <div class="diff-comment-avatar-holders"\n      :class="discussionClassName"\n      v-show="notesCount !== 0">\n      <div v-if="!isVisible">\n        \x3c!-- FIXME: Pass an alt attribute here for accessibility --\x3e\n        <user-avatar-image\n          v-for="note in notesSubset"\n          :key="note.id"\n          class="diff-comment-avatar js-diff-comment-avatar"\n          @click.native="clickedAvatar($event)"\n          :img-src="note.authorAvatar"\n          :tooltip-text="getTooltipText(note)"\n          :data-line-type="lineType"\n          :size="19"\n          data-html="true"\n        />\n        <span v-if="notesCount > shownAvatars"\n          class="diff-comments-more-count has-tooltip js-diff-comment-avatar"\n          data-container="body"\n          data-placement="top"\n          ref="extraComments"\n          role="button"\n          :data-line-type="lineType"\n          :title="extraNotesTitle"\n          @click="clickedAvatar($event)">{{ moreText }}</span>\n      </div>\n      <button class="diff-notes-collapse js-diff-comment-avatar"\n        type="button"\n        aria-label="Show comments"\n        :data-line-type="lineType"\n        @click="clickedAvatar($event)"\n        v-if="isVisible"\n        v-html="collapseIcon">\n      </button>\n    </div>\n  '});d.default.component("diff-note-avatars",_);var S=d.default.extend({props:{discussionId:{type:String,required:!0}},data:function(){return{discussions:CommentsStore.state}},computed:{discussion:function(){return this.discussions[this.discussionId]},showButton:function(){return!!this.discussion&&!this.discussion.isResolved()}}});d.default.component("new-issue-for-discussion-btn",S);n(26),n(27);var T=n(11);function x(e,t){var n=function(e,t){return 0===e?"".concat(t," ").concat(Object(m.c)("merge request","merge requests",t)):","}(e,t);return o()("<span />",{class:"append-right-5",text:n})}function I(e){var t=o()("<span />"),n=function(e){return o()("<a />",{class:"append-right-5",href:e.path,text:"!".concat(e.iid)})}(e),i=function(e){return o()("<span />",{text:e.title})}(e);return t.append(n),t.append(i),t}function N(){var e=o()(".merge-requests");T.a.get(e.data("projectCommitPath")).then((function(t){var n=function(e){var t=o()("<span />");return 0===e.length?t.text(Object(m.d)("Commits|No related merge requests found")):e.forEach((function(n){var i=x(t.children().length,e.length),o=I(n);t.append(i),t.append(o)})),t}(t.data);e.html(n)})).catch((function(){return Flash(Object(m.d)("Commits|An error occurred while fetching merge requests data."))}))}n(1386);document.addEventListener("DOMContentLoaded",(function(){var e,t=document.querySelector(".with-performance-bar")?35:0;new s.a,new r.a,new a.a,new c.a({container:".js-commit-pipeline-graph"}).bindEvents(),Object(l.a)(),Object(u.a)(document.querySelector(".navbar-gitlab").offsetHeight+t),o()(".commit-info.branches").load(document.querySelector(".js-commit-box").dataset.commitPath),N(),e=(document.querySelector(".merge-request")||document.querySelector(".commit-box")).dataset.projectPath,window.gl=window.gl||{},window.gl.diffNoteApps={},window.ResolveService=new gl.DiffNotesResolveServiceClass(e),gl.diffNotesCompileComponents=function(){o()("diff-note-avatars").each((function(){var e=(new(d.default.extend({template:o()(this).get(0).outerHTML}))).$mount();o()(this).replaceWith(e.$el),o()(e.$el).one("remove.vue",(function(){e.$destroy(),e.$el.remove()}))}));var e=o()("resolve-btn, jump-to-discussion, comment-and-resolve-btn, new-issue-for-discussion-btn").filter((function(){return 1!==o()(this).closest("resolve-count").length}));e&&e.each((function(){var e=o()(this),t=e.attr(":note-id"),n=e.attr(":discussion-id");if(!e.is("comment-and-resolve-btn")||n){var i=(new(d.default.extend({template:e.get(0).outerHTML}))).$mount();t&&(gl.diffNoteApps["note_".concat(t)]=i),e.replaceWith(i.$el)}}))},gl.diffNotesCompileComponents(),o()(window).trigger("resize.nav")}))},257:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));n(65);var i=n(71);function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var s=function(){function e(t,n,o){var s=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.field=t,this.isLocalStorageAvailable=i.a.isLocalStorageAccessSafe(),null!=n.join&&(n=n.join("/")),this.key="autosave/".concat(n),this.fallbackKey=o,this.field.data("autosave",this),this.restore(),this.field.on("input",(function(){return s.save()}))}var t,n,s;return t=e,(n=[{key:"restore",value:function(){if(this.isLocalStorageAvailable&&this.field.length){var e=window.localStorage.getItem(this.key),t=window.localStorage.getItem(this.fallbackKey);e?this.field.val(e):t&&this.field.val(t),this.field.trigger("input");var n=new Event("change",{bubbles:!0,cancelable:!1}),i=this.field.get(0);i&&i.dispatchEvent(n)}}},{key:"save",value:function(){if(this.field.length){var e=this.field.val();return this.isLocalStorageAvailable&&e?(this.fallbackKey&&window.localStorage.setItem(this.fallbackKey,e),window.localStorage.setItem(this.key,e)):this.reset()}}},{key:"reset",value:function(){if(this.isLocalStorageAvailable)return window.localStorage.removeItem(this.fallbackKey),window.localStorage.removeItem(this.key)}},{key:"dispose",value:function(){this.field.off("input")}}])&&o(t.prototype,n),s&&o(t,s),e}()},259:function(e,t,n){"use strict";n(24),n(49),n(56),n(26),n(78),n(40),n(69),n(145),n(18),n(68),n(36),n(27),n(41),n(90),n(30),n(65),n(46),n(55),n(91),n(67);var i=n(20),o=/\{\{(.+?)\}\}/g,s={toCamelCase:function(e){return this.camelize(e.split("-").slice(1).join(" "))},template:function(e,t){var n=Object(i.template)(e,{escape:o});return n(t)},camelize:function(e){return e.replace(/(?:^\w|[A-Z]|\b\w)/g,(function(e,t){return 0===t?e.toLowerCase():e.toUpperCase()})).replace(/\s+/g,"")},closest:function(e,t){for(;e&&e.tagName!==t&&"HTML"!==e.tagName;)e=e.parentNode;return e},isDropDownParts:function(e){return!(!e||!e.hasAttribute||"HTML"===e.tagName)&&(e.hasAttribute("data-dropdown-trigger")||e.hasAttribute("data-dropdown"))}};function r(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var c=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.currentIndex=0,this.hidden=!0,this.list="string"==typeof t?document.querySelector(t):t,this.items=[],this.eventWrapper={},this.hideOnClick=!1!==n.hideOnClick,n.addActiveClassToDropdownButton&&(this.dropdownToggle=this.list.parentNode.querySelector(".js-dropdown-toggle")),this.getItems(),this.initTemplateString(),this.addEvents(),this.initialState=t.innerHTML}var t,n,i;return t=e,i=[{key:"setImagesSrc",value:function(e){r(e.querySelectorAll("img[data-src]")).forEach((function(e){var t=e;t.src=t.getAttribute("data-src"),t.removeAttribute("data-src")}))}}],(n=[{key:"getItems",value:function(){return this.items=[].slice.call(this.list.querySelectorAll("li")),this.items}},{key:"initTemplateString",value:function(){var e=this.items||this.getItems(),t="";return e.length>0&&(t=e[e.length-1].outerHTML),this.templateString=t,this.templateString}},{key:"clickEvent",value:function(e){if("UL"!==e.target.tagName&&!e.target.closest(".".concat("droplab-item-ignore"))){var t=e.target.closest("li");if(t){this.addSelectedClass(t),e.preventDefault(),this.hideOnClick&&this.hide();var n=new CustomEvent("click.dl",{detail:{list:this,selected:t,data:e.target.dataset}});this.list.dispatchEvent(n)}}}},{key:"addSelectedClass",value:function(e){this.removeSelectedClasses(),e.classList.add("droplab-item-selected")}},{key:"removeSelectedClasses",value:function(){(this.items||this.getItems()).forEach((function(e){return e.classList.remove("droplab-item-selected")}))}},{key:"addEvents",value:function(){this.eventWrapper.clickEvent=this.clickEvent.bind(this),this.eventWrapper.closeDropdown=this.closeDropdown.bind(this),this.list.addEventListener("click",this.eventWrapper.clickEvent),this.list.addEventListener("keyup",this.eventWrapper.closeDropdown)}},{key:"closeDropdown",value:function(e){return 27!==e.keyCode||(e.preventDefault(),this.toggle())}},{key:"setData",value:function(e){this.data=e,this.render(e)}},{key:"addData",value:function(e){this.data=(this.data||[]).concat(e),this.render(this.data)}},{key:"render",value:function(e){var t=e?e.map(this.renderChildren.bind(this)):[];if(!this.list.querySelector(".filter-dropdown-loading")){(this.list.querySelector("ul[data-dynamic]")||this.list).innerHTML=t.join("");var n=new CustomEvent("render.dl",{detail:{list:this}});this.list.dispatchEvent(n)}}},{key:"renderChildren",value:function(t){var n=s.template(this.templateString,t),i=document.createElement("div");return i.innerHTML=n,e.setImagesSrc(i),i.firstChild.style.display=t.droplab_hidden?"none":"block",i.firstChild.outerHTML}},{key:"show",value:function(){this.hidden&&(this.list.style.display="block",this.currentIndex=0,this.hidden=!1,this.dropdownToggle&&this.dropdownToggle.classList.add("active"))}},{key:"hide",value:function(){this.hidden||(this.list.style.display="none",this.currentIndex=0,this.hidden=!0,this.dropdownToggle&&this.dropdownToggle.classList.remove("active"))}},{key:"toggle",value:function(){return this.hidden?this.show():this.hide()}},{key:"destroy",value:function(){this.hide(),this.list.removeEventListener("click",this.eventWrapper.clickEvent),this.list.removeEventListener("keyup",this.eventWrapper.closeDropdown)}}])&&a(t.prototype,n),i&&a(t,i),e}();var l=function e(t,n,i,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.trigger=t,this.list=new c(n,o),this.type="Hook",this.event="click",this.plugins=i||[],this.config=o||{},this.id=t.id};function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function f(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var v=function(e){function t(e,n,i,o){var s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(s=f(this,h(t).call(this,e,n,i,o))).type="button",s.event="click",s.eventWrapper={},s.addEvents(),s.addPlugins(),s}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(t,e),n=t,(i=[{key:"addPlugins",value:function(){var e=this;this.plugins.forEach((function(t){return t.init(e)}))}},{key:"clicked",value:function(e){var t=new CustomEvent("click.dl",{detail:{hook:this},bubbles:!0,cancelable:!0});e.target.dispatchEvent(t),this.list.toggle()}},{key:"addEvents",value:function(){this.eventWrapper.clicked=this.clicked.bind(this),this.trigger.addEventListener("click",this.eventWrapper.clicked)}},{key:"removeEvents",value:function(){this.trigger.removeEventListener("click",this.eventWrapper.clicked)}},{key:"restoreInitialState",value:function(){this.list.list.innerHTML=this.list.initialState}},{key:"removePlugins",value:function(){this.plugins.forEach((function(e){return e.destroy()}))}},{key:"destroy",value:function(){this.restoreInitialState(),this.removeEvents(),this.removePlugins()}}])&&d(n.prototype,i),o&&d(n,o),t}(l);function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function g(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function y(e,t){return!t||"object"!==m(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var k=function(e){function t(e,n,i,o){var s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(s=y(this,b(t).call(this,e,n,i,o))).type="input",s.event="input",s.eventWrapper={},s.addEvents(),s.addPlugins(),s}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(t,e),n=t,(i=[{key:"addPlugins",value:function(){var e=this;this.plugins.forEach((function(t){return t.init(e)}))}},{key:"addEvents",value:function(){this.eventWrapper.mousedown=this.mousedown.bind(this),this.eventWrapper.input=this.input.bind(this),this.eventWrapper.keyup=this.keyup.bind(this),this.eventWrapper.keydown=this.keydown.bind(this),this.trigger.addEventListener("mousedown",this.eventWrapper.mousedown),this.trigger.addEventListener("input",this.eventWrapper.input),this.trigger.addEventListener("keyup",this.eventWrapper.keyup),this.trigger.addEventListener("keydown",this.eventWrapper.keydown)}},{key:"removeEvents",value:function(){this.hasRemovedEvents=!0,this.trigger.removeEventListener("mousedown",this.eventWrapper.mousedown),this.trigger.removeEventListener("input",this.eventWrapper.input),this.trigger.removeEventListener("keyup",this.eventWrapper.keyup),this.trigger.removeEventListener("keydown",this.eventWrapper.keydown)}},{key:"input",value:function(e){if(!this.hasRemovedEvents){this.list.show();var t=new CustomEvent("input.dl",{detail:{hook:this,text:e.target.value},bubbles:!0,cancelable:!0});e.target.dispatchEvent(t)}}},{key:"mousedown",value:function(e){if(!this.hasRemovedEvents){var t=new CustomEvent("mousedown.dl",{detail:{hook:this,text:e.target.value},bubbles:!0,cancelable:!0});e.target.dispatchEvent(t)}}},{key:"keyup",value:function(e){this.hasRemovedEvents||this.keyEvent(e,"keyup.dl")}},{key:"keydown",value:function(e){this.hasRemovedEvents||this.keyEvent(e,"keydown.dl")}},{key:"keyEvent",value:function(e,t){this.list.show();var n=new CustomEvent(t,{detail:{hook:this,text:e.target.value,which:e.which,key:e.key},bubbles:!0,cancelable:!0});e.target.dispatchEvent(n)}},{key:"restoreInitialState",value:function(){this.list.list.innerHTML=this.list.initialState}},{key:"removePlugins",value:function(){this.plugins.forEach((function(e){return e.destroy()}))}},{key:"destroy",value:function(){this.restoreInitialState(),this.removeEvents(),this.removePlugins(),this.list.destroy()}}])&&g(n.prototype,i),o&&g(n,o),t}(l),j=function(){var e,t=!1,n=!1,i=function(e){for(var t=Array.prototype.slice.call(e.list.querySelectorAll("li:not(.divider):not(.hidden)"),0),n=[],i=0;i<t.length;i++){var o=t[i];o.classList.remove("droplab-item-active"),"none"!==o.style.display&&n.push(o)}return n},o=function(e){var t=i(e)[e.currentIndex-1],n=new CustomEvent("click.dl",{detail:{list:e,selected:t,data:t.dataset}});e.list.dispatchEvent(n),e.hide()};document.addEventListener("mousedown.dl",(function(e){var o=e.detail.hook.list;i(o),o.show(),o.currentIndex=0,t=!1,n=!1})),document.addEventListener("keydown.dl",(function(s){s.target;var r=s.detail.hook.list,a=r.currentIndex;if(t=!1,n=!1,s.detail.which){if(13===(e=s.detail.which))return void o(s.detail.hook.list);38===e&&(t=!0),40===e&&(n=!0)}else if(s.detail.key){if("Enter"===(e=s.detail.key))return void o(s.detail.hook.list);"ArrowUp"===e&&(t=!0),"ArrowDown"===e&&(n=!0)}t&&a--,n&&a++,a<0&&(a=0),r.currentIndex=a,function(e){var t=i(e);if(e.currentIndex>0&&(t[e.currentIndex-1]||(e.currentIndex=e.currentIndex-1),t[e.currentIndex-1])){var n=t[e.currentIndex-1],o=n.closest(".filter-dropdown");if(n.classList.add("droplab-item-active"),o){var s=o.offsetHeight,r=n.offsetTop-30;r>s&&(o.scrollTop=r-s)}}}(s.detail.hook.list)}))};function C(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function E(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var _=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.ready=!1,this.hooks=[],this.queuedData=[],this.config={},this.eventWrapper={}}var t,n,i;return t=e,(n=[{key:"loadStatic",value:function(){var e=[].slice.apply(document.querySelectorAll("[".concat("data-dropdown-trigger","]")));this.addHooks(e)}},{key:"addData",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.applyArgs(t,"processAddData")}},{key:"setData",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.applyArgs(t,"processSetData")}},{key:"destroy",value:function(){this.hooks.forEach((function(e){return e.destroy()})),this.hooks=[],this.removeEvents()}},{key:"applyArgs",value:function(e,t){return this.ready?this[t].apply(this,C(e)):(this.queuedData=this.queuedData||[],this.queuedData.push(e),this.ready)}},{key:"processAddData",value:function(e,t){this.processData(e,t,"addData")}},{key:"processSetData",value:function(e,t){this.processData(e,t,"setData")}},{key:"processData",value:function(e,t,n){this.hooks.forEach((function(i){Array.isArray(e)&&i.list[n](e),i.trigger.id===e&&i.list[n](t)}))}},{key:"addEvents",value:function(){this.eventWrapper.documentClicked=this.documentClicked.bind(this),document.addEventListener("mousedown",this.eventWrapper.documentClicked)}},{key:"documentClicked",value:function(e){var t=e.target;"UL"!==t.tagName&&(t=s.closest(t,"UL")),s.isDropDownParts(t,this.hooks)||s.isDropDownParts(e.target,this.hooks)||this.hooks.forEach((function(e){return e.list.hide()}))}},{key:"removeEvents",value:function(){document.removeEventListener("mousedown",this.eventWrapper.documentClicked)}},{key:"changeHookList",value:function(e,t,n,i){var o=this,s="string"==typeof e?document.getElementById(e):e;this.hooks.forEach((function(e,r){var a=e;a.list.list.dataset.dropdownActive=!1,a.trigger===s&&(a.destroy(),o.hooks.splice(r,1),o.addHook(s,t,n,i))}))}},{key:"addHook",value:function(e,t,n,i){var o,r="string"==typeof e?document.querySelector(e):e;(o="string"==typeof t?document.querySelector(t):t instanceof Element?t:document.querySelector(e.dataset[s.toCamelCase("data-dropdown-trigger")])).dataset.dropdownActive=!0;var a="INPUT"===r.tagName?k:v;return this.hooks.push(new a(r,o,n,i)),this}},{key:"addHooks",value:function(e,t,n){var i=this;return e.forEach((function(e){return i.addHook(e,null,t,n)})),this}},{key:"setConfig",value:function(e){this.config=e}},{key:"fireReady",value:function(){var e=new CustomEvent("ready.dl",{detail:{dropdown:this}});document.dispatchEvent(e),this.ready=!0}},{key:"init",value:function(e,t,n,i){var o=this;return e?this.addHook(e,t,n,i):this.loadStatic(),this.addEvents(),j(),this.fireReady(),this.queuedData.forEach((function(e){return o.addData(e)})),this.queuedData=[],this}}])&&E(t.prototype,n),i&&E(t,i),e}();t.a=_},312:function(e,t,n){var i=n(651),o=0;e.exports=function(e){var t=++o;return i(e)+t}},345:function(e,t,n){"use strict";n(26),n(27);var i={init:function(e){this.hook=e,this.destroyed=!1,this.config=e.config.InputSetter||(this.hook.config.InputSetter={}),this.eventWrapper={},this.addEvents()},addEvents:function(){this.eventWrapper.setInputs=this.setInputs.bind(this),this.hook.list.list.addEventListener("click.dl",this.eventWrapper.setInputs)},removeEvents:function(){this.hook.list.list.removeEventListener("click.dl",this.eventWrapper.setInputs)},setInputs:function(e){var t=this;if(!this.destroyed){var n=e.detail.selected;Array.isArray(this.config)||(this.config=[this.config]),this.config.forEach((function(e){return t.setInput(e,n)}))}},setInput:function(e,t){var n=e.input||this.hook.trigger,i=t.getAttribute(e.valueAttribute),o=e.inputAttribute;return n.hasAttribute(o)?n.setAttribute(o,i):"INPUT"===n.tagName?n.value=i:n.textContent=i},destroy:function(){this.destroyed=!0,this.removeEvents()}};t.a=i},377:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));n(24),n(49),n(56),n(40),n(65),n(18),n(36),n(41);var i=n(0),o=n.n(i),s=(n(681),n(1)),r=n(11),a=n(14);function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var d=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.selector=t.selector,this.dataType=t.dataType,this.fieldName=t.fieldName,this.lockVersion=t.lockVersion,this.taskListContainerSelector="".concat(this.selector," .js-task-list-container"),this.updateHandler=this.update.bind(this),this.onSuccess=t.onSuccess||function(){},this.onError=t.onError||function(e){var t="";return e.response.data&&"object"===l(e.response.data)&&(t=e.response.data.errors.join(" ")),new a.a(t||Object(s.a)("Update failed"),"alert")},this.init()}var t,n,i;return t=e,(n=[{key:"init",value:function(){this.disable(),o()(this.taskListContainerSelector).taskList("enable"),o()(document).on("tasklist:changed",this.taskListContainerSelector,this.updateHandler)}},{key:"getTaskListTarget",value:function(e){return e&&e.currentTarget?o()(e.currentTarget):o()(this.taskListContainerSelector)}},{key:"disableTaskListItems",value:function(e){this.getTaskListTarget(e).taskList("disable")}},{key:"enableTaskListItems",value:function(e){this.getTaskListTarget(e).taskList("enable")}},{key:"disable",value:function(){this.disableTaskListItems(),o()(document).off("tasklist:changed",this.taskListContainerSelector)}},{key:"update",value:function(e){var t,n=this,i=o()(e.target),s=e.detail,a=s.index,l=s.checked,u=s.lineNumber,d=s.lineSource,f={};return f[this.dataType]=(c(t={},this.fieldName,i.val()),c(t,"lock_version",this.lockVersion),c(t,"update_task",{index:a,checked:l,line_number:u,line_source:d}),t),this.disableTaskListItems(e),r.a.patch(i.data("updateUrl")||o()("form.js-issuable-update").attr("action"),f).then((function(t){var i=t.data;return n.lockVersion=i.lock_version,n.enableTaskListItems(e),n.onSuccess(i)})).catch((function(t){var i=t.response;return n.enableTaskListItems(e),n.onError(i.data)}))}}])&&u(t.prototype,n),i&&u(t,i),e}()},378:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return a}));var i=n(484),o=n.n(i),s=function(e,t,n,i){var o=Math.floor(e.offsetTop-t);if(o<=n&&!e.classList.contains("is-stuck")){var s=i?function(){var e=document.createElement("div");return e.classList.add("sticky-placeholder"),e}():null,r=e.offsetHeight;e.classList.add("is-stuck"),i&&(e.parentNode.insertBefore(s,e.nextElementSibling),s.style.height="".concat(r-e.offsetHeight,"px"))}else o>n&&e.classList.contains("is-stuck")&&(e.classList.remove("is-stuck"),i&&e.nextElementSibling&&e.nextElementSibling.classList.contains("sticky-placeholder")&&e.nextElementSibling.remove())},r=function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];e&&"undefined"!=typeof CSS&&CSS.supports("(position: -webkit-sticky) or (position: sticky)")&&document.addEventListener("scroll",(function(){return s(e,window.scrollY,t,n)}),{passive:!0})},a=function(e){o.a.add(e)}},484:function(e,t,n){!function(t,n){"use strict";var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var o,s=!1,r=void 0!==t;r&&t.getComputedStyle?(o=n.createElement("div"),["","-webkit-","-moz-","-ms-"].some((function(e){try{o.style.position=e+"sticky"}catch(e){}return""!=o.style.position}))&&(s=!0)):s=!0;var a=!1,c="undefined"!=typeof ShadowRoot,l={top:null,left:null},u=[];function d(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}function f(e){return parseFloat(e)||0}function h(e){for(var t=0;e;)t+=e.offsetTop,e=e.offsetParent;return t}var p=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!(t instanceof HTMLElement))throw new Error("First argument must be HTMLElement");if(u.some((function(e){return e._node===t})))throw new Error("Stickyfill is already applied to this node");this._node=t,this._stickyMode=null,this._active=!1,u.push(this),this.refresh()}return i(e,[{key:"refresh",value:function(){if(!s&&!this._removed){this._active&&this._deactivate();var e=this._node,i=getComputedStyle(e),o={position:i.position,top:i.top,display:i.display,marginTop:i.marginTop,marginBottom:i.marginBottom,marginLeft:i.marginLeft,marginRight:i.marginRight,cssFloat:i.cssFloat};if(!isNaN(parseFloat(o.top))&&"table-cell"!=o.display&&"none"!=o.display){this._active=!0;var r=e.style.position;"sticky"!=i.position&&"-webkit-sticky"!=i.position||(e.style.position="static");var a=e.parentNode,l=c&&a instanceof ShadowRoot?a.host:a,u=e.getBoundingClientRect(),p=l.getBoundingClientRect(),v=getComputedStyle(l);this._parent={node:l,styles:{position:l.style.position},offsetHeight:l.offsetHeight},this._offsetToWindow={left:u.left,right:n.documentElement.clientWidth-u.right},this._offsetToParent={top:u.top-p.top-f(v.borderTopWidth),left:u.left-p.left-f(v.borderLeftWidth),right:-u.right+p.right-f(v.borderRightWidth)},this._styles={position:r,top:e.style.top,bottom:e.style.bottom,left:e.style.left,right:e.style.right,width:e.style.width,marginTop:e.style.marginTop,marginLeft:e.style.marginLeft,marginRight:e.style.marginRight};var m=f(o.top);this._limits={start:u.top+t.pageYOffset-m,end:p.top+t.pageYOffset+l.offsetHeight-f(v.borderBottomWidth)-e.offsetHeight-m-f(o.marginBottom)};var g=v.position;"absolute"!=g&&"relative"!=g&&(l.style.position="relative"),this._recalcPosition();var y=this._clone={};y.node=n.createElement("div"),d(y.node.style,{width:u.right-u.left+"px",height:u.bottom-u.top+"px",marginTop:o.marginTop,marginBottom:o.marginBottom,marginLeft:o.marginLeft,marginRight:o.marginRight,cssFloat:o.cssFloat,padding:0,border:0,borderSpacing:0,fontSize:"1em",position:"static"}),a.insertBefore(y.node,e),y.docOffsetTop=h(y.node)}}}},{key:"_recalcPosition",value:function(){if(this._active&&!this._removed){var e=l.top<=this._limits.start?"start":l.top>=this._limits.end?"end":"middle";if(this._stickyMode!=e){switch(e){case"start":d(this._node.style,{position:"absolute",left:this._offsetToParent.left+"px",right:this._offsetToParent.right+"px",top:this._offsetToParent.top+"px",bottom:"auto",width:"auto",marginLeft:0,marginRight:0,marginTop:0});break;case"middle":d(this._node.style,{position:"fixed",left:this._offsetToWindow.left+"px",right:this._offsetToWindow.right+"px",top:this._styles.top,bottom:"auto",width:"auto",marginLeft:0,marginRight:0,marginTop:0});break;case"end":d(this._node.style,{position:"absolute",left:this._offsetToParent.left+"px",right:this._offsetToParent.right+"px",top:"auto",bottom:0,width:"auto",marginLeft:0,marginRight:0})}this._stickyMode=e}}}},{key:"_fastCheck",value:function(){this._active&&!this._removed&&(Math.abs(h(this._clone.node)-this._clone.docOffsetTop)>1||Math.abs(this._parent.node.offsetHeight-this._parent.offsetHeight)>1)&&this.refresh()}},{key:"_deactivate",value:function(){var e=this;this._active&&!this._removed&&(this._clone.node.parentNode.removeChild(this._clone.node),delete this._clone,d(this._node.style,this._styles),delete this._styles,u.some((function(t){return t!==e&&t._parent&&t._parent.node===e._parent.node}))||d(this._parent.node.style,this._parent.styles),delete this._parent,this._stickyMode=null,this._active=!1,delete this._offsetToWindow,delete this._offsetToParent,delete this._limits)}},{key:"remove",value:function(){var e=this;this._deactivate(),u.some((function(t,n){if(t._node===e._node)return u.splice(n,1),!0})),this._removed=!0}}]),e}(),v={stickies:u,Sticky:p,forceSticky:function(){s=!1,m(),this.refreshAll()},addOne:function(e){if(!(e instanceof HTMLElement)){if(!e.length||!e[0])return;e=e[0]}for(var t=0;t<u.length;t++)if(u[t]._node===e)return u[t];return new p(e)},add:function(e){if(e instanceof HTMLElement&&(e=[e]),e.length){for(var t=[],n=function(n){var i=e[n];return i instanceof HTMLElement?u.some((function(e){if(e._node===i)return t.push(e),!0}))?"continue":void t.push(new p(i)):(t.push(void 0),"continue")},i=0;i<e.length;i++)n(i);return t}},refreshAll:function(){u.forEach((function(e){return e.refresh()}))},removeOne:function(e){if(!(e instanceof HTMLElement)){if(!e.length||!e[0])return;e=e[0]}u.some((function(t){if(t._node===e)return t.remove(),!0}))},remove:function(e){if(e instanceof HTMLElement&&(e=[e]),e.length)for(var t=function(t){var n=e[t];u.some((function(e){if(e._node===n)return e.remove(),!0}))},n=0;n<e.length;n++)t(n)},removeAll:function(){for(;u.length;)u[0].remove()}};function m(){if(!a){a=!0,s(),t.addEventListener("scroll",s),t.addEventListener("resize",v.refreshAll),t.addEventListener("orientationchange",v.refreshAll);var e=void 0,i=void 0,o=void 0;"hidden"in n?(i="hidden",o="visibilitychange"):"webkitHidden"in n&&(i="webkitHidden",o="webkitvisibilitychange"),o?(n[i]||r(),n.addEventListener(o,(function(){n[i]?clearInterval(e):r()}))):r()}function s(){t.pageXOffset!=l.left?(l.top=t.pageYOffset,l.left=t.pageXOffset,v.refreshAll()):t.pageYOffset!=l.top&&(l.top=t.pageYOffset,l.left=t.pageXOffset,u.forEach((function(e){return e._recalcPosition()})))}function r(){e=setInterval((function(){u.forEach((function(e){return e._fastCheck()}))}),500)}}s||m(),e.exports?e.exports=v:r&&(t.Stickyfill=v)}(window,document)},501:function(e,t,n){"use strict";n.d(t,"a",(function(){return G}));n(24),n(49),n(56),n(30),n(28),n(42),n(40),n(46),n(18),n(55),n(68),n(36),n(67),n(41);var i=n(0),o=n.n(i),s=n(11),r=n(14),a=n(1),c=n(33),l=n(51),u=n.n(l),d=".".concat("diff-line-num",", .line_content"),f={init:function(e){var t=this;this.userCanCreateNote||(this.userCanCreateNote=""===e.closest(".files").data("canCreateNote")),this.isParallelView="parallel"===u.a.get("diff_view"),this.userCanCreateNote&&e.on("mouseover",d,(function(e){return t.showButton(t.isParallelView,e)})).on("mouseleave",d,(function(e){return t.hideButton(t.isParallelView,e)}))},showButton:function(e,t){var n=this.getButtonParent(t.currentTarget,e);this.validateButtonParent(n)&&(n.classList.add("is-over"),n.nextElementSibling.classList.add("is-over"))},hideButton:function(e,t){var n=this.getButtonParent(t.currentTarget,e);n.classList.remove("is-over"),n.nextElementSibling.classList.remove("is-over")},getButtonParent:function(e,t){if(t){if(!e.classList.contains("diff-line-num"))return e.previousElementSibling}else if(!e.classList.contains("old_line"))return e.parentNode.querySelector(".".concat("old_line"));return e},validateButtonParent:function(e){return!(e.classList.contains("empty-cell")||e.classList.contains("js-unfold")||e.classList.contains("no-comment-btn")||e.parentNode.classList.contains("diff-expanded"))}},h=(n(26),n(78),n(145),n(77),n(27),n(16));function p(e,t){var n=t.x,i=t.y,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],s=document.createElement("button");return o.concat(["js-image-badge"]).forEach((function(e){return s.classList.add(e)})),s.setAttribute("type","button"),s.setAttribute("disabled",!0),s.dataset.noteId=e,s.style.left="".concat(n,"px"),s.style.top="".concat(i,"px"),s}function v(e,t){var n=t.x,i=t.y,o=document.createElement("button");o.classList.add("btn-transparent"),o.classList.add("comment-indicator"),o.setAttribute("type","button"),o.style.left="".concat(n,"px"),o.style.top="".concat(i,"px"),o.innerHTML=Object(h.Q)("image-comment-dark"),e.appendChild(o)}var m={x:0,y:0,width:0,height:0},g=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var n=t.noteId,i=t.discussionId;this.actual=t.actual||m,this.browser=t.browser||m,this.noteId=n,this.discussionId=i,t.imageEl&&!t.browser&&(this.browser=y.resizeCoordinatesToImageElement(t.imageEl,this.actual))};var y={addCommentIndicator:v,removeCommentIndicator:function(e){var t=e.querySelector(".comment-indicator"),n=e.querySelector("img"),i=Boolean(t),o={};return i&&(o={x:parseInt(t.style.left,10),y:parseInt(t.style.top,10),image:{width:n.width,height:n.height}},t.remove()),Object.assign({},o,{removed:i})},showCommentIndicator:function(e,t){var n=t.x,i=t.y,o=e.querySelector(".comment-indicator");o?(o.style.left="".concat(n,"px"),o.style.top="".concat(i,"px")):v(e,t)},commentIndicatorOnClick:function(e){e.stopPropagation(),e.currentTarget.closest(".diff-viewer").querySelector(".note-container .note-textarea").focus()},addImageBadge:function(e,t){var n=t.coordinate,i=t.badgeText,o=p(t.noteId,n,["badge","badge-pill"]);o.innerText=i,e.appendChild(o)},addImageCommentBadge:function(e,t){var n=t.coordinate,i=p(t.noteId,n,["image-comment-badge"]);i.innerHTML=Object(h.Q)("image-comment-dark"),e.appendChild(i)},addAvatarBadge:function(e,t){var n=t.detail,i=n.noteId,o=n.badgeNumber,s=e.querySelector("#".concat(i," .badge"));s.innerText=o,s.classList.remove("hidden")},setPositionDataAttribute:function(e,t){var n=t.x,i=t.y,o=t.width,s=t.height,r=e.dataset.position,a=Object.assign({},JSON.parse(r),{x:n,y:i,width:o,height:s});e.setAttribute("data-position",JSON.stringify(a))},updateDiscussionAvatarBadgeNumber:function(e,t){e.querySelector(".image-diff-avatar-link .badge").innerText=t},updateDiscussionBadgeNumber:function(e,t){e.querySelector(".badge").innerText=t},toggleCollapsed:function(e){var t=e.currentTarget.closest(".discussion-notes"),n=t.querySelector(".discussion-form"),i=t.classList.contains("collapsed");i?t.classList.remove("collapsed"):t.classList.add("collapsed"),n&&!i?n.style.display="none":n&&i&&(n.style.display="block")},resizeCoordinatesToImageElement:function(e,t){var n=t.x,i=t.y,o=t.width,s=t.height,r=e.width,a=e.height,c=r/o,l=a/s;return{x:Math.round(n*c),y:Math.round(i*l),width:r,height:a}},generateBadgeFromDiscussionDOM:function(e,t){var n=JSON.parse(t.dataset.position),i=t.querySelector(".note");return new g({actual:n,imageEl:e.querySelector("img"),noteId:i.id,discussionId:t.dataset.discussionId})},getTargetSelection:function(e){var t=e.currentTarget.querySelector("img"),n=e.offsetX,i=e.offsetY,o=t.width,s=t.height,r=t.naturalWidth,a=t.naturalHeight,c=r/o,l=a/s,u=Math.max(0,n)&&Math.min(n,o),d=Math.max(0,i)&&Math.min(i,s);return{browser:{x:u,y:d,width:o,height:s},actual:{x:Math.round(u*c),y:Math.round(d*l),width:r,height:a}}}};function b(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function w(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var k=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.el=t,this.canCreateNote=Boolean(n&&n.canCreateNote),this.renderCommentBadge=Boolean(n&&n.renderCommentBadge),this.$noteContainer=o()(".note-container",this.el),this.imageBadges=[]}var t,n,i;return t=e,(n=[{key:"init",value:function(){this.imageFrameEl=this.el.querySelector(".diff-file .js-image-frame"),this.imageEl=this.imageFrameEl.querySelector("img"),this.bindEvents()}},{key:"bindEvents",value:function(){var e;this.imageClickedWrapper=this.imageClicked.bind(this),this.imageBlurredWrapper=y.removeCommentIndicator.bind(null,this.imageFrameEl),this.addBadgeWrapper=this.addBadge.bind(this),this.removeBadgeWrapper=this.removeBadge.bind(this),this.renderBadgesWrapper=this.renderBadges.bind(this),(e=this.imageEl).complete&&0!==e.naturalHeight?this.renderBadges():this.imageEl.addEventListener("load",this.renderBadgesWrapper),this.$noteContainer.on("click",".js-diff-notes-toggle",y.toggleCollapsed),o()(this.el).on("click",".comment-indicator",y.commentIndicatorOnClick),this.canCreateNote&&(this.el.addEventListener("click.imageDiff",this.imageClickedWrapper),this.el.addEventListener("blur.imageDiff",this.imageBlurredWrapper),this.el.addEventListener("addBadge.imageDiff",this.addBadgeWrapper),this.el.addEventListener("removeBadge.imageDiff",this.removeBadgeWrapper))}},{key:"imageClicked",value:function(e){var t=e.detail,n=y.getTargetSelection(t),i=t.currentTarget;y.setPositionDataAttribute(i,n.actual),y.showCommentIndicator(this.imageFrameEl,n.browser)}},{key:"renderBadges",value:function(){b(this.el.querySelectorAll(".note-container .discussion-notes .notes")).forEach(this.renderBadge.bind(this))}},{key:"renderBadge",value:function(e,t){var n=y.generateBadgeFromDiscussionDOM(this.imageFrameEl,e);this.imageBadges.push(n);var i={coordinate:n.browser,noteId:n.noteId};if(this.renderCommentBadge)y.addImageCommentBadge(this.imageFrameEl,i);else{var o=Object.assign({},i,{badgeText:t+1});y.addImageBadge(this.imageFrameEl,o)}}},{key:"addBadge",value:function(e){var t=e.detail,n=t.x,i=t.y,o=t.width,s=t.height,r=t.noteId,a=t.discussionId,c=this.imageBadges.length+1,l=new g({actual:{x:n,y:i,width:o,height:s},imageEl:this.imageFrameEl.querySelector("img"),noteId:r,discussionId:a});this.imageBadges.push(l),y.addImageBadge(this.imageFrameEl,{coordinate:l.browser,badgeText:c,noteId:r}),y.addAvatarBadge(this.el,{detail:{noteId:r,badgeNumber:c}});var u=this.el.querySelector("#discussion_".concat(a));y.updateDiscussionBadgeNumber(u,c)}},{key:"removeBadge",value:function(e){var t=this,n=e.detail.badgeNumber,i=n-1,o=this.imageFrameEl.querySelectorAll(".badge");this.imageBadges.length!==n&&this.imageBadges.forEach((function(e,n){if(n>i){var s=e.discussionId,r=n,a=t.el.querySelector("#discussion_".concat(s));o[n].innerText=r,y.updateDiscussionBadgeNumber(a,r),y.updateDiscussionAvatarBadgeNumber(a,r)}})),this.imageBadges.splice(i,1),o[i].remove()}}])&&w(t.prototype,n),i&&w(t,i),e}(),j=(n(50),n(531),n(90),n(184),{TWO_UP:"TWO_UP",SWIPE:"SWIPE",ONION_SKIN:"ONION_SKIN"});function C(e){return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function E(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function _(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function S(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function T(e,t){return!t||"object"!==C(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function x(e,t,n){return(x="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=I(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function I(e){return(I=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function N(e,t){return(N=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var O=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),T(this,I(t).apply(this,arguments))}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&N(e,t)}(t,e),n=t,(i=[{key:"init",value:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j.TWO_UP;this.imageFrameEls=(_(e={},j.TWO_UP,this.el.querySelector(".two-up .js-image-frame")),_(e,j.SWIPE,this.el.querySelector(".swipe .js-image-frame")),_(e,j.ONION_SKIN,this.el.querySelector(".onion-skin .js-image-frame")),e);var i=this.el.querySelector(".view-modes-menu");this.viewModesEls=(_(t={},j.TWO_UP,i.querySelector(".two-up")),_(t,j.SWIPE,i.querySelector(".swipe")),_(t,j.ONION_SKIN,i.querySelector(".onion-skin")),t),this.currentView=n,this.generateImageEls(),this.bindEvents()}},{key:"generateImageEls",value:function(){var e=this;this.imageEls={},Object.getOwnPropertyNames(j).forEach((function(t){e.imageEls[t]=e.imageFrameEls[t].querySelector("img")}))}},{key:"bindEvents",value:function(){x(I(t.prototype),"bindEvents",this).call(this),this.changeToViewTwoUp=this.changeView.bind(this,j.TWO_UP),this.changeToViewSwipe=this.changeView.bind(this,j.SWIPE),this.changeToViewOnionSkin=this.changeView.bind(this,j.ONION_SKIN),this.viewModesEls[j.TWO_UP].addEventListener("click",this.changeToViewTwoUp),this.viewModesEls[j.SWIPE].addEventListener("click",this.changeToViewSwipe),this.viewModesEls[j.ONION_SKIN].addEventListener("click",this.changeToViewOnionSkin)}},{key:"changeView",value:function(e){if(t=e,Boolean(Object.getOwnPropertyNames(j).find((function(e){return e===t})))){var t,n=y.removeCommentIndicator(this.imageFrameEl);this.currentView=e,E(this.imageFrameEl.querySelectorAll(".badge")).map((function(e){return e.remove()})),this.imageBadges=[],setTimeout(this.renderNewView.bind(this,n),250)}}},{key:"renderNewView",value:function(e){if(this.renderBadges(),e.removed){var t=y.resizeCoordinatesToImageElement(this.imageEl,{x:e.x,y:e.y,width:e.image.width,height:e.image.height});y.showCommentIndicator(this.imageFrameEl,t)}}},{key:"imageEl",get:function(){return this.imageEls[this.currentView]}},{key:"imageFrameEl",get:function(){return this.imageFrameEls[this.currentView]}}])&&S(n.prototype,i),o&&S(n,o),t}(k);n(91);function A(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],i=!0,o=!1,s=void 0;try{for(var r,a=e[Symbol.iterator]();!(i=(r=a.next()).done)&&(n.push(r.value),!t||n.length!==t);i=!0);}catch(e){o=!0,s=e}finally{try{i||null==a.return||a.return()}finally{if(o)throw s}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function L(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var D=900,P=["two-up","swipe"],B=function(){function e(t){var n,i,s,r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),s={"two-up":function(){var e=this;return o()(".two-up.view .wrap",this.file).each((function(t,n){return o()("img",n).each((function(){if(o()(this).width()>D/2)return o()(this).width(D/2)})),e.requestImageInfo(o()("img",n),(function(e,t){return o()(".image-info .meta-width",n).text("".concat(e,"px")),o()(".image-info .meta-height",n).text("".concat(t,"px")),o()(".image-info",n).removeClass("hide")}))}))},swipe:function(){var t=this,n=0,i=0;return o()(".swipe.view",this.file).each((function(s,r){var a=A(e.prepareFrames(r),2);n=a[0],i=a[1];var c=o()(".swipe-frame",r),l=o()(".swipe-wrap",r),u=o()(".swipe-bar",r);c.css({width:n+16,height:i+28}),l.css({width:n+1,height:i+2}),u.css({left:1});var d=parseInt(l.css("right").replace("px",""),10);t.initDraggable(u,d,(function(e,t){t>0&&t<c.width()-2*d&&(l.width(n+1-t),u.css("left",t))}))}))},"onion-skin":function(){var t,n,i=this;n=0,t=0;var s=o()(".drag-track",this.file).width()-o()(".dragger",this.file).width();return o()(".onion-skin.view",this.file).each((function(r,a){var c=A(e.prepareFrames(a),2);n=c[0],t=c[1];var l=o()(".onion-skin-frame",a),u=o()(".frame.added",a),d=o()(".drag-track",a),f=o()(".dragger",d);l.css({width:n+16,height:t+28}),o()(".swipe-wrap",a).css({width:n+1,height:t+2}),f.css({left:s}),u.css("opacity",1);var h=parseInt(u.css("right").replace("px",""),10);i.initDraggable(f,h,(function(e,t){var n=t/s;n>=0&&n<=1&&(f.css("left",t),u.css("opacity",n))}))}))}},(i="views")in(n=this)?Object.defineProperty(n,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[i]=s,this.file=t,this.requestImageInfo(o()(".two-up.view .frame.deleted img",this.file),(function(){return r.requestImageInfo(o()(".two-up.view .frame.added img",r.file),(function(){r.initViewModes(),o()(".two-up.view img",r.file).waitForImages((function(){r.initView("two-up")}))}))}))}var t,n,i;return t=e,i=[{key:"prepareFrames",value:function(e){var t=0,n=0;return o()(".frame",e).each((function(e,i){var s=o()(i).width(),r=o()(i).height();return t=s>t?s:t,n=r>n?r:n})).css({width:t,height:n}),[t,n]}}],(n=[{key:"initViewModes",value:function(){var e=this,t=P[0];return o()(".view-modes",this.file).removeClass("hide"),o()(".view-modes-menu",this.file).on("click","li",(function(t){if(!o()(t.currentTarget).hasClass("active"))return e.activateViewMode(t.currentTarget.className)})),this.activateViewMode(t)}},{key:"activateViewMode",value:function(e){var t=this;return o()(".view-modes-menu li",this.file).removeClass("active").filter(".".concat(e)).addClass("active"),o()(".view:visible:not(.".concat(e,")"),this.file).fadeOut(200,(function(){return o()(".view.".concat(e),t.file).fadeIn(200),t.initView(e)}))}},{key:"initView",value:function(e){return this.views[e].call(this)}},{key:"initDraggable",value:function(e,t,n){var i=!1,s=o()("body"),r=e.parent(),a=function(){i=!0,s.css("user-select","none")},c=function(){i=!1,s.css("user-select","")},l=function(e){var o=(e.pageX||e.touches[0].pageX)-(r.offset().left+t);i&&n(e,o)};e.off("mousedown").off("touchstart").on("mousedown",a).on("touchstart",a),s.off("mouseup").off("mousemove").off("touchend").off("touchmove").on("mouseup",c).on("touchend",c).on("mousemove",l).on("touchmove",l)}},{key:"requestImageInfo",value:function(e,t){var n=this,i=e.get(0);if(i)return i.complete?t.call(this,i.naturalWidth,i.naturalHeight):e.on("load",(function(){return t.call(n,i.naturalWidth,i.naturalHeight)}))}}])&&L(t.prototype,n),i&&L(t,i),e}();var F={initImageDiff:function(e,t,n){var i,o={canCreateNote:t,renderCommentBadge:n};return new B(e),e.querySelector(".diff-file .js-single-image")?(i=new k(e,o)).init():e.querySelector(".diff-file .js-replaced-image")&&(i=new O(e,o)).init(),i}},R=n(379);function q(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var M='<div class="diff-content"></div>',$='<span class="spinner"></span>',W='<div class="nothing-here-block diff-collapsed">This diff is collapsed. <button class="click-to-expand btn btn-link">Click to expand it.</button></div>',z=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.file=t,this.toggleDiff=this.toggleDiff.bind(this),this.content=o()(".diff-content",this.file),this.$toggleIcon=o()(".diff-toggle-caret",this.file),this.diffForPath=this.content.find("[data-diff-for-path]").data("diffForPath"),this.isOpen=!this.diffForPath,this.diffForPath?(this.collapsedContent=this.content,this.loadingContent=o()(M).addClass("loading").html($).hide(),this.content=null,this.collapsedContent.after(this.loadingContent),this.$toggleIcon.addClass("fa-caret-right")):(this.collapsedContent=o()(M).html(W).hide(),this.content.after(this.collapsedContent),this.$toggleIcon.addClass("fa-caret-down")),o()(".js-file-title, .click-to-expand",this.file).on("click",(function(e){n.toggleDiff(o()(e.target))}))}var t,n,i;return t=e,(n=[{key:"toggleDiff",value:function(e,t){if(e.hasClass("js-file-title")||e.hasClass("click-to-expand")||e.hasClass("diff-toggle-caret"))if(this.isOpen=!this.isOpen,this.isOpen||this.hasError){if(!this.content)return this.$toggleIcon.addClass("fa-caret-down").removeClass("fa-caret-right"),this.getContentHTML(t);this.collapsedContent.hide(),this.content.show(),this.$toggleIcon.addClass("fa-caret-down").removeClass("fa-caret-right"),void 0!==gl.diffNotesCompileComponents&&gl.diffNotesCompileComponents()}else this.content.hide(),this.$toggleIcon.addClass("fa-caret-right").removeClass("fa-caret-down"),this.collapsedContent.show(),void 0!==gl.diffNotesCompileComponents&&gl.diffNotesCompileComponents()}},{key:"getContentHTML",value:function(e){var t=this;this.collapsedContent.hide(),this.loadingContent.show(),s.a.get(this.diffForPath).then((function(n){var i=n.data;t.loadingContent.hide(),i.html?(t.content=o()(i.html),Object(R.a)(t.content)):(t.hasError=!0,t.content=o()('<div class="nothing-here-block"><i class="fa fa-warning"></i> Could not load diff</div>')),t.collapsedContent.after(t.content),void 0!==gl.diffNotesCompileComponents&&gl.diffNotesCompileComponents();var s=o()(t.file);f.init(s);var r=s.closest(".files").is("[data-can-create-note]");F.initImageDiff(s[0],r),e&&e()})).catch((function(){Object(r.a)(Object(a.a)("An error occurred while retrieving diff"))}))}}])&&q(t.prototype,n),i&&q(t,i),e}();function H(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],i=!0,o=!1,s=void 0;try{for(var r,a=e[Symbol.iterator]();!(i=(r=a.next()).done)&&(n.push(r.value),!t||n.length!==t);i=!0);}catch(e){o=!0,s=e}finally{try{i||null==a.return||a.return()}finally{if(o)throw s}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function U(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var V=!1,G=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var t=o()(".files .diff-file");t.each((function(e,t){o.a.data(t,"singleFileDiff")||o.a.data(t,"singleFileDiff",new z(t))}));var n=document.getElementById("diffs");(!n||n&&n.dataset&&""!==n.dataset.isLocked)&&f.init(t);var i=o()(".files").first().get(0),s=i&&i.hasAttribute("data-can-create-note");t.each((function(e,t){return F.initImageDiff(t,s)})),V||(o()(document).on("click",".js-unfold",this.handleClickUnfold.bind(this)).on("click",".diff-line-num a",this.handleClickLineNum.bind(this)).on("mousedown","td.line_content.parallel",this.handleParallelLineDown.bind(this)),V=!0),Object(c.d)()&&this.highlightSelectedLine(),this.openAnchoredDiff()}var t,n,i;return t=e,(n=[{key:"handleClickUnfold",value:function(e){var t,n,i=o()(e.target),c=H(this.lineNumbers(i.parent()),2),l=c[0],u=c[1],d=u-l,f=i.hasClass("js-unfold-bottom"),h=!0;if(f){var p=u+1;t=p,n=p+20}else{var v=u-1;t=v-20,n=v;var m=this.lineNumbers(i.parent().prev())[1];t<=m+1&&(t=m+1,h=!1)}var g=i.parents(".diff-file"),y=g.data("blobDiffPath"),b={since:t,to:n,bottom:f,offset:d,unfold:h,view:g.data("view")};s.a.get(y,{params:b}).then((function(e){var t=e.data;return i.parent().replaceWith(t)})).catch((function(){return Object(r.a)(Object(a.a)("An error occurred while loading diff"))}))}},{key:"openAnchoredDiff",value:function(e){var t=this,n=Object(c.d)(),i=n&&n.split("_")[0];if(i){var s=o()("#".concat(i)).closest(".diff-file");if(o()(".nothing-here-block:visible",s).length){var r=o()(".js-file-title, .click-to-expand",s);s.data("singleFileDiff").toggleDiff(r,(function(){t.highlightSelectedLine(),e&&e()}))}else e&&e()}}},{key:"handleClickLineNum",value:function(e){var t=o()(e.currentTarget).attr("href");e.preventDefault(),window.history.pushState?window.history.pushState(null,null,t):window.location.hash=t,this.highlightSelectedLine()}},{key:"handleParallelLineDown",value:function(e){var t=o()(e.currentTarget),n=t.closest("table");n.removeClass("left-side-selected right-side-selected");var i=["left-side","right-side"].filter((function(e){return t.hasClass(e)}))[0];i&&n.addClass("".concat(i,"-selected"))}},{key:"diffViewType",value:function(){return o()(".inline-parallel-buttons a.active").data("viewType")}},{key:"lineNumbers",value:function(e){var t=e.find(".diff-line-num").toArray();return 2!==t.length?[0,0]:t.map((function(e){return parseInt(o()(e).data("linenumber"),10)||0}))}},{key:"highlightSelectedLine",value:function(){var e=Object(c.d)(),t=o()(".diff-file");t.find(".hll").removeClass("hll"),e&&t.find("tr#".concat(e,":not(.match) td, td#").concat(e,', td[data-line-code="').concat(e,'"]')).addClass("hll")}}])&&U(t.prototype,n),i&&U(t,i),e}()},531:function(e,t,n){var i=n(108),o=n(239),s=n(837).f;i({target:"Object",stat:!0,forced:o((function(){return!Object.getOwnPropertyNames(1)}))},{getOwnPropertyNames:s})},550:function(e,t,n){"use strict";n.d(t,"a",(function(){return q}));n(24),n(49),n(30),n(28),n(42),n(65),n(35),n(38),n(18),n(64),n(1039),n(311),n(55),n(68),n(91),n(67),n(89);var i=n(312),o=n.n(i),s=n(93),r=n.n(s),a=n(0),c=n.n(a),l=n(51),u=n.n(l),d=n(157),f=n.n(d),h=(n(1002),n(838),n(17)),p=n(2532),v=n(200),m=n(379),g=n(11),y=n(33),b=n(14),w=n(164),k=(n(77),n(259)),j=n(345);function C(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var E=Object.assign({},j.a),_=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.dropdownTrigger=t.dropdownTrigger,this.dropdownList=t.dropdownList,this.noteTypeInput=t.noteTypeInput,this.submitButton=t.submitButton,this.closeButton=t.closeButton,this.reopenButton=t.reopenButton}var t,n,i;return t=e,(n=[{key:"initDroplab",value:function(){this.droplab=new k.a;var e=this.setConfig();this.droplab.init(this.dropdownTrigger,this.dropdownList,[E],e)}},{key:"setConfig",value:function(){var e={InputSetter:[{input:this.noteTypeInput,valueAttribute:"data-value"},{input:this.submitButton,valueAttribute:"data-submit-text"}]};return this.closeButton&&e.InputSetter.push({input:this.closeButton,valueAttribute:"data-close-text"},{input:this.closeButton,valueAttribute:"data-close-text",inputAttribute:"data-alternative-text"}),this.reopenButton&&e.InputSetter.push({input:this.reopenButton,valueAttribute:"data-reopen-text"},{input:this.reopenButton,valueAttribute:"data-reopen-text",inputAttribute:"data-alternative-text"}),e}}])&&C(t.prototype,n),i&&C(t,i),e}(),S=n(208),T=n(464),x=n(257),I=n(377),N=n(16),O=n(62),A=n(1);function L(e,t,n){return(L=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,n){var i=[null];i.push.apply(i,t);var o=new(Function.bind.apply(e,i));return n&&D(o,n.prototype),o}).apply(null,arguments)}function D(e,t){return(D=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function P(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function B(e,t,n){return t&&P(e.prototype,t),n&&P(e,n),e}function F(e){return e.replace(/\r\n/g,"\n")}window.autosize=f.a;var R=/^\/\w+.*$/gm,q=function(){function e(t,n,i,o){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:w.b;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.updateTargetButtons=this.updateTargetButtons.bind(this),this.updateComment=this.updateComment.bind(this),this.visibilityChange=this.visibilityChange.bind(this),this.cancelDiscussionForm=this.cancelDiscussionForm.bind(this),this.onAddDiffNote=this.onAddDiffNote.bind(this),this.onAddImageDiffNote=this.onAddImageDiffNote.bind(this),this.setupDiscussionNoteForm=this.setupDiscussionNoteForm.bind(this),this.onReplyToDiscussionNote=this.onReplyToDiscussionNote.bind(this),this.removeNote=this.removeNote.bind(this),this.cancelEdit=this.cancelEdit.bind(this),this.updateNote=this.updateNote.bind(this),this.addDiscussionNote=this.addDiscussionNote.bind(this),this.addNoteError=this.addNoteError.bind(this),this.addNote=this.addNote.bind(this),this.resetMainTargetForm=this.resetMainTargetForm.bind(this),this.refresh=this.refresh.bind(this),this.keydownNoteText=this.keydownNoteText.bind(this),this.toggleCommitList=this.toggleCommitList.bind(this),this.postComment=this.postComment.bind(this),this.clearFlashWrapper=this.clearFlash.bind(this),this.onHashChange=this.onHashChange.bind(this),this.notes_url=t,this.note_ids=n,this.enableGFM=s,this.updatedNotesTrackingMap={},this.last_fetched_at=i,this.noteable_url=document.URL,this.notesCountBadge||(this.notesCountBadge=c()(".issuable-details").find(".notes-tab .badge")),this.basePollingInterval=15e3,this.maxPollingSteps=4,this.$wrapperEl=Object(N.x)()?c()(document).find(".diffs"):c()(document),this.cleanBinding(),this.addBinding(),this.setPollingInterval(),this.setupMainTargetNoteForm(s),this.taskList=new I.a({dataType:"note",fieldName:"note",selector:".notes"}),this.collapseLongCommitList(),this.setViewType(o),"merge_requests"===Object(N.l)(1)&&c()(".note-edit-form").clone().addClass("mr-note-edit-form").insertAfter(".note-edit-form");var r=Object(y.d)(),a=r&&document.getElementById(r);a&&this.loadLazyDiff({currentTarget:a})}return B(e,null,[{key:"initialize",value:function(t,n,i,o,s){this.instance||(this.instance=new e(t,n,i,o,s))}},{key:"getInstance",value:function(){return this.instance}}]),B(e,[{key:"setViewType",value:function(e){this.view=u.a.get("diff_view")||e}},{key:"addBinding",value:function(){this.$wrapperEl.on("click",".js-note-edit",this.showEditForm.bind(this)),this.$wrapperEl.on("click",".note-edit-cancel",this.cancelEdit),this.$wrapperEl.on("click",".js-comment-submit-button",this.postComment),this.$wrapperEl.on("click",".js-comment-save-button",this.updateComment),this.$wrapperEl.on("keyup input",".js-note-text",this.updateTargetButtons),this.$wrapperEl.on("click",".js-comment-resolve-button",this.postComment),this.$wrapperEl.on("click",".js-note-delete",this.removeNote),this.$wrapperEl.on("click",".js-note-attachment-delete",this.removeAttachment),this.$wrapperEl.on("change",".js-note-attachment-input",this.updateFormAttachment),this.$wrapperEl.on("click",".js-discussion-reply-button",this.onReplyToDiscussionNote),this.$wrapperEl.on("click",".js-add-diff-note-button",this.onAddDiffNote),this.$wrapperEl.on("click",".js-add-image-diff-note-button",this.onAddImageDiffNote),this.$wrapperEl.on("click",".js-close-discussion-note-form",this.cancelDiscussionForm),this.$wrapperEl.on("click",".system-note-commit-list-toggler",this.toggleCommitList),this.$wrapperEl.on("click",".js-toggle-lazy-diff",this.loadLazyDiff),this.$wrapperEl.on("click",".js-toggle-lazy-diff-retry-button",this.onClickRetryLazyLoad.bind(this)),this.$wrapperEl.on("visibilitychange",this.visibilityChange),this.$wrapperEl.on("issuable:change",this.refresh),this.$wrapperEl.on("ajax:success",".js-main-target-form",this.addNote),this.$wrapperEl.on("ajax:success",".js-discussion-note-form",this.addDiscussionNote),this.$wrapperEl.on("ajax:success",".js-main-target-form",this.resetMainTargetForm),this.$wrapperEl.on("ajax:complete",".js-main-target-form",this.reenableTargetFormSubmitButton),this.$wrapperEl.on("keydown",".js-note-text",this.keydownNoteText),c()(window).on("hashchange",this.onHashChange)}},{key:"cleanBinding",value:function(){this.$wrapperEl.off("click",".js-note-edit"),this.$wrapperEl.off("click",".note-edit-cancel"),this.$wrapperEl.off("click",".js-note-delete"),this.$wrapperEl.off("click",".js-note-attachment-delete"),this.$wrapperEl.off("click",".js-discussion-reply-button"),this.$wrapperEl.off("click",".js-add-diff-note-button"),this.$wrapperEl.off("click",".js-add-image-diff-note-button"),this.$wrapperEl.off("visibilitychange"),this.$wrapperEl.off("keyup input",".js-note-text"),this.$wrapperEl.off("click",".js-note-target-reopen"),this.$wrapperEl.off("click",".js-note-target-close"),this.$wrapperEl.off("keydown",".js-note-text"),this.$wrapperEl.off("click",".js-comment-resolve-button"),this.$wrapperEl.off("click",".system-note-commit-list-toggler"),this.$wrapperEl.off("click",".js-toggle-lazy-diff"),this.$wrapperEl.off("click",".js-toggle-lazy-diff-retry-button"),this.$wrapperEl.off("ajax:success",".js-main-target-form"),this.$wrapperEl.off("ajax:success",".js-discussion-note-form"),this.$wrapperEl.off("ajax:complete",".js-main-target-form"),c()(window).off("hashchange",this.onHashChange)}},{key:"keydownNoteText",value:function(e){var t,n,i;if(!Object(N.B)(e)){var o=c()(e.target);switch(e.which){case 38:if(""!==o.val())return;if((i=c()("li.note[data-author-id='".concat(gon.current_user_id,"'][data-editable]:last"),o.closest(".note, .notes_holder, #notes"))).length)return i.find(".js-note-edit").trigger("click",[!0,i]);break;case 27:if((t=o.closest(".js-discussion-note-form")).length){if(""!==o.val()&&!window.confirm(Object(A.a)("Are you sure you want to cancel creating this comment?")))return;return void this.removeDiscussionNoteForm(t)}if((n=o.closest(".note")).length){if(o.closest("form").data("originalNote")!==o.val()&&!window.confirm(Object(A.a)("Are you sure you want to cancel editing this comment?")))return;return this.removeNoteEditForm(n)}}}}},{key:"initRefresh",value:function(){var t=this;e.interval&&clearInterval(e.interval),e.interval=setInterval((function(){return t.refresh()}),this.pollingInterval)}},{key:"refresh",value:function(){if(!document.hidden)return this.getContent()}},{key:"getContent",value:function(){var e=this;this.refreshing||(this.refreshing=!0,g.a.get("".concat(this.notes_url,"?html=true"),{headers:{"X-Last-Fetched-At":this.last_fetched_at}}).then((function(t){var n=t.data,i=n.notes;e.last_fetched_at=n.last_fetched_at,e.setPollingInterval(n.notes.length),c.a.each(i,(function(t,n){return e.renderNote(n)})),e.refreshing=!1})).catch((function(){e.refreshing=!1})))}},{key:"setPollingInterval",value:function(e){null==e&&(e=!0);var t=this.basePollingInterval*Math.pow(2,this.maxPollingSteps-1);return e?this.pollingInterval=this.basePollingInterval:this.pollingInterval<t&&(this.pollingInterval*=2),this.initRefresh()}},{key:"handleQuickActions",value:function(t){var n;t.commands_changes&&("merge"in t.commands_changes&&e.checkMergeRequestStatus(),"emoji_award"in t.commands_changes&&(n=c()(".js-awards-block").eq(0),Object(T.b)().then((function(e){e.addAwardToEmojiBar(n,t.commands_changes.emoji_award),e.scrollToAwards()})).catch((function(){}))))}},{key:"setupNewNote",value:function(t){Object(O.l)(t.find(".js-timeago"),!1),this.collapseLongCommitList(),this.taskList.init(),e.updateNoteTargetSelector(t),this.$noteToCleanHighlight=t}},{key:"onHashChange",value:function(){this.$noteToCleanHighlight&&e.updateNoteTargetSelector(this.$noteToCleanHighlight),this.$noteToCleanHighlight=null}},{key:"renderNote",value:function(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:c()(".main-notes-list");if(t.discussion_html)return this.renderDiscussionNote(t,n);if(t.valid){var o=i.find("#note_".concat(t.id));if(e.isNewNote(t,this.note_ids)){if(Object(N.x)())return;this.note_ids.push(t.id),i.length&&i.find(".system-note.being-posted").remove();var s=e.animateAppendNote(t.html,i);return this.setupNewNote(s),this.refresh(),this.updateNotesCount(1)}if(e.isUpdatedNote(t,o)){var r=o.hasClass("is-editing"),a=F(o.find(".original-note-content").text().trim()),l=o.find(".js-note-text"),u=l.val(),d=F(t.note),f=u===a||u===d;if(r&&f)l.val(t.note),this.updatedNotesTrackingMap[t.id]=t;else if(r&&!f)this.putConflictEditWarningInPlace(t,o),this.updatedNotesTrackingMap[t.id]=t;else{var h=e.animateUpdateNote(t.html,o);this.setupNewNote(h)}}}else t.errors&&t.errors.commands_only&&(t.commands_changes&&Object.keys(t.commands_changes).length>0&&i.find(".system-note.being-posted").remove(),this.addFlash(t.errors.commands_only,"notice",this.parentTimeline.get(0)),this.refresh())}},{key:"isParallelView",value:function(){return"parallel"===u.a.get("diff_view")}},{key:"renderDiscussionNote",value:function(t,n){var i,o;if(e.isNewNote(t,this.note_ids)){this.note_ids.push(t.id);var s=n||c()('.js-discussion-note-form[data-discussion-id="'.concat(t.discussion_id,'"]'));o=s.length||!t.discussion_line_code?s.closest("tr"):c()("#".concat(t.discussion_line_code)),t.on_image&&(o=s);var r=this.isParallelView()?s.find("#line_type").val():"old",a=o.prevAll(".line_holder").first().find(".js-avatar-container.".concat(r,"_line"));if((i=c()('.notes[data-discussion-id="'.concat(t.discussion_id,'"]'))).length||(i=s.closest(".discussion").find(".notes")),0===i.length)if(t.diff_discussion_html){var l=c()(t.diff_discussion_html).renderGFM();if(!this.isParallelView()||o.hasClass("js-temp-notes-holder")||t.on_image)o.after(l);else{var u=l.find('.notes[data-discussion-id="'.concat(t.discussion_id,'"]')),d=u.closest(".notes-content").attr("class").split(" ").join(".");o.find(".".concat(d," .content")).append(u.closest(".content").children())}}else e.animateAppendNote(t.discussion_html,c()(".main-notes-list"));else e.animateAppendNote(t.html,i);return void 0!==gl.diffNotesCompileComponents&&t.discussion_resolvable&&(gl.diffNotesCompileComponents(),this.renderDiscussionAvatar(a,t)),Object(O.l)(c()(".js-timeago"),!1),e.checkMergeRequestStatus(),this.updateNotesCount(1)}}},{key:"getLineHolder",value:function(e){return c()(e).closest(".notes_holder").prevAll(".line_holder").first().get(0)}},{key:"renderDiscussionAvatar",value:function(e,t){var n=e.find(".diff-comment-avatar-holders");n.length||((n=document.createElement("diff-note-avatars")).setAttribute("discussion-id",t.discussion_id),e.append(n),gl.diffNotesCompileComponents())}},{key:"resetMainTargetForm",value:function(e){var t=c()(".js-main-target-form");t.find(".js-errors").remove(),t.find(".js-md-write-button").click(),t.find(".js-note-text").val("").trigger("input"),t.find(".js-note-text").data("autosave").reset();var n=document.createEvent("Event");n.initEvent("autosize:update",!0,!1),t.find(".js-autosize")[0].dispatchEvent(n),this.updateTargetButtons(e)}},{key:"reenableTargetFormSubmitButton",value:function(){return c()(".js-main-target-form").find(".js-note-text").trigger("input")}},{key:"setupMainTargetNoteForm",value:function(t){var n=c()(".js-new-note-form");this.formClone=n.clone(),this.setupNoteForm(n,t),n.removeClass("js-new-note-form"),n.addClass("js-main-target-form"),n.find("#note_line_code").remove(),n.find("#note_position").remove(),n.find("#note_type").val(""),n.find("#note_project_id").remove(),n.find("#in_reply_to_discussion_id").remove(),n.find(".js-comment-resolve-button").closest("comment-and-resolve-btn").remove(),this.parentTimeline=n.parents(".timeline"),n.length&&e.initCommentTypeToggle(n.get(0))}},{key:"setupNoteForm",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:w.b;this.glForm=new S.a(e,t);var n=e.find(".js-note-text"),i=[Object(A.d)("NoteForm|Note"),e.find("#note_noteable_type").val(),e.find("#note_noteable_id").val(),e.find("#note_commit_id").val(),e.find("#note_type").val(),e.find("#note_project_id").val(),e.find("#in_reply_to_discussion_id").val(),e.find("#note_line_code").val(),e.find("#note_position").val()];return new x.a(n,i)}},{key:"addNote",value:function(e,t){return this.renderNote(t)}},{key:"addNoteError",value:function(e){var t;return e.hasClass("js-main-target-form")?t=e.parents(".timeline"):e.hasClass("js-discussion-note-form")&&(t=e.closest(".discussion-notes").find(".notes")),this.addFlash(Object(A.a)("Your comment could not be submitted! Please check your network connection and try again."),"alert",t.get(0))}},{key:"updateNoteError",value:function(){new b.a(Object(A.a)("Your comment could not be updated! Please check your network connection and try again."))}},{key:"addDiscussionNote",value:function(e,t,n){if(null!=e.attr("data-resolve-all")){var i=e.data("discussionId"),o=e.data("noteableIid");null!=ResolveService&&ResolveService.toggleResolveForDiscussion(o,i)}this.renderNote(t,e),n&&this.removeDiscussionNoteForm(e)}},{key:"updateNote",value:function(e,t){var n=c()(e.html);this.revertNoteEditForm(t),n.renderGFM(),c()(".note-row-".concat(e.id)).replaceWith(n),this.setupNewNote(n),void 0!==gl.diffNotesCompileComponents&&gl.diffNotesCompileComponents()}},{key:"checkContentToAllowEditing",value:function(e){var t=e.find(".original-note-content").text().trim(),n=!0;e.find(".js-note-text").val()===t?this.removeNoteEditForm(e):(Object(N.z)(e.get(0))||Object(N.N)(e),e.find(".js-finish-edit-warning").show(),n=!1);return n}},{key:"showEditForm",value:function(e){e.preventDefault();var t=c()(e.target),n=c()(this.getEditFormSelector(t)),i=t.closest(".note"),o=c()(".note.is-editing:visible");if(o.length&&!this.checkContentToAllowEditing(o))return;i.find(".js-note-attachment-delete").show(),n.addClass("current-note-edit-form"),i.addClass("is-editing"),this.putEditFormInPlace(t)}},{key:"cancelEdit",value:function(e){e.preventDefault();var t=c()(e.target),n=t.closest(".note"),i=n.attr("data-note-id");if(this.revertNoteEditForm(t),this.updatedNotesTrackingMap[i]){var o=c()(this.updatedNotesTrackingMap[i].html);n.replaceWith(o),this.setupNewNote(o),delete this.updatedNotesTrackingMap[i]}else n.find(".js-finish-edit-warning").hide(),this.removeNoteEditForm(n)}},{key:"revertNoteEditForm",value:function(e){e=e||c()(".note.is-editing:visible");var t=this.getEditFormSelector(e),n=c()(t);n.insertBefore(".diffs"),n.find(".js-comment-save-button").enable(),n.find(".js-finish-edit-warning").hide()}},{key:"getEditFormSelector",value:function(e){var t=".note-edit-form:not(.mr-note-edit-form)";return e.parents("#diffs").length&&(t=".note-edit-form.mr-note-edit-form"),t}},{key:"removeNoteEditForm",value:function(e){var t=e.find(".diffs .current-note-edit-form");return e.removeClass("is-editing"),t.removeClass("current-note-edit-form"),t.find(".js-finish-edit-warning").hide(),t.find(".js-note-text").val(t.find("form.edit-note").data("originalNote"))}},{key:"removeNote",value:function(t){var n=c()(t.currentTarget).closest(".note").attr("id");return c()('.note[id="'.concat(n,'"]')).each((function(e,t){var i=c()(t),o=i.closest(".discussion-notes"),s=c()(".notes",o).data("discussionId");if(void 0!==gl.diffNotesCompileComponents&&gl.diffNoteApps[n]&&gl.diffNoteApps[n].$destroy(),i.remove(),0===o.find(".note").length){var r=o.closest("tr");if(o.closest(".timeline-entry").remove(),c()(".js-diff-avatars-".concat(s)).trigger("remove.vue"),r.find(".discussion-notes").length>1||0===r.length){var a=o.closest(".diff-file");if(a.length>0){var l=new CustomEvent("removeBadge.imageDiff",{detail:{badgeNumber:o.index()+1}});a[0].dispatchEvent(l)}o.remove()}else r.length>0&&r.remove()}})),e.checkMergeRequestStatus(),this.updateNotesCount(-1)}},{key:"removeAttachment",value:function(){var e=c()(this).closest(".note");return e.find(".note-attachment").remove(),e.find(".note-body > .note-text").show(),e.find(".note-header").show(),e.find(".diffs .current-note-edit-form").remove()}},{key:"onReplyToDiscussionNote",value:function(e){this.replyToDiscussionNote(e.target)}},{key:"replyToDiscussionNote",value:function(e){var t=this.cleanForm(this.formClone.clone()),n=c()(e).closest(".js-discussion-reply-button");return n.closest(".discussion-reply-holder").hide().after(t),this.setupDiscussionNoteForm(n,t)}},{key:"setupDiscussionNoteForm",value:function(e,t){var n=e.closest(".text-file");0===n.length&&(n=e.closest(".image"));var i=e.data("discussionId");(i&&(t.attr("data-discussion-id",i),t.find("#in_reply_to_discussion_id").val(i)),t.find("#note_project_id").val(e.data("discussionProjectId")),t.attr("data-line-code",e.data("lineCode")),t.find("#line_type").val(e.data("lineType")),t.find("#note_noteable_type").val(n.data("noteableType")),t.find("#note_noteable_id").val(n.data("noteableId")),t.find("#note_commit_id").val(n.data("commitId")),t.find("#note_type").val(e.data("noteType")),t.find("#note_line_code").val(e.data("lineCode")),t.find("#note_position").val(e.attr("data-position")),t.prepend('<div class="avatar-note-form-holder"><div class="content"><a href="'.concat(r()(gon.current_username),'" class="user-avatar-link d-none d-sm-block"><img class="avatar s40" src="').concat(encodeURI(gon.current_user_avatar_url),'" alt="').concat(r()(gon.current_user_fullname),'" /></a></div></div>')).append("</div>").find(".js-close-discussion-note-form").show().removeClass("hide"),t.find(".js-note-target-close").remove(),t.find(".js-note-new-discussion").remove(),this.setupNoteForm(t),t.removeClass("js-main-target-form").addClass("discussion-form js-discussion-note-form"),void 0!==gl.diffNotesCompileComponents)&&(t.find("comment-and-resolve-btn").attr(":discussion-id","'".concat(i,"'")),gl.diffNotesCompileComponents());t.find(".js-note-text").focus(),t.find(".js-comment-resolve-button").attr("data-discussion-id",i)}},{key:"onAddDiffNote",value:function(e){e.preventDefault();var t=e.currentTarget||e.target,n=c()(t),i=!n.hasClass("js-diff-comment-avatar");this.toggleDiffNote({target:n,lineType:t.dataset.lineType,showReplyInput:i,currentUsername:gon.current_username,currentUserAvatar:gon.current_user_avatar_url,currentUserFullname:gon.current_user_fullname})}},{key:"onAddImageDiffNote",value:function(e){var t,n=c()(e.currentTarget||e.target),i=n.closest(".diff-file"),o=new CustomEvent("click.imageDiff",{detail:e});i[0].dispatchEvent(o);var s=n.closest(".diff-viewer").find(".note-container"),r=s.find("> .discussion-form");0===r.length?(t=this.cleanForm(this.formClone.clone())).appendTo(s):t=r,this.setupDiscussionNoteForm(n,t)}},{key:"toggleDiffNote",value:function(e){var t,n,i,o,s=e.target,r=e.lineType,a=e.forceShow,l=e.showReplyInput,u=void 0!==l&&l,d=c()(s),f=d.closest("tr"),h=f.next(),p=f;h.is(".notes_holder")&&(p=h);var v=h.is(".notes_holder");t=!1;var m="";o='<tr class="notes_holder js-temp-notes-holder"><td class="notes-content" colspan="3"><div class="content"></div></td></tr>',this.isParallelView()&&(m=".".concat(r),o='<tr class="notes_holder js-temp-notes-holder"><td class="notes_line old"></td><td class="notes-content parallel old"><div class="content"></div></td><td class="notes_line new"></td><td class="notes-content parallel new"><div class="content"></div></td></tr>');var g=".notes-content".concat(m," .content"),y=p.find(g);if(v&&u)p.show(),(y=p.find(g)).length&&(y.show(),(i=y.find(".js-discussion-reply-button:visible")).length?this.replyToDiscussionNote(i[0]):0===y.find(".js-discussion-note-form").length&&(t=!0));else if(u)f.after(o),y=(p=f.next()).find(g),t=!0;else{var b=p.find(".content:not(:empty)").is(":visible"),w=!0===a||!b&&!(!0===a||!1===a);p.toggleClass("hide",!w),y.toggleClass("hide",!w)}if(t)return(n=this.cleanForm(this.formClone.clone())).appendTo(y),this.setupDiscussionNoteForm(d,n)}},{key:"removeDiscussionNoteForm",value:function(e){var t=e.closest("tr");return e.data("glForm").destroy(),e.find(".js-note-text").data("autosave").reset(),e.prev(".discussion-reply-holder").show(),t.is(".js-temp-notes-holder")?t.remove():e.remove()}},{key:"cancelDiscussionForm",value:function(e){e.preventDefault();var t=c()(e.target).closest(".js-discussion-note-form");if(0===c()(e.target).closest(".discussion-notes").length){var n=t.closest(".diff-file");if(n.length>0){var i=new CustomEvent("blur.imageDiff",{detail:e});n[0].dispatchEvent(i)}}return this.removeDiscussionNoteForm(t)}},{key:"updateFormAttachment",value:function(){var e=c()(this).closest("form"),t=c()(this).val().replace(/^.*[\\\/]/,"");return e.find(".js-attachment-filename").text(t)}},{key:"visibilityChange",value:function(){return this.refresh()}},{key:"updateTargetButtons",value:function(e){var t,n,i=c()(e.target),o=i.parents("form"),s=o.find(".js-note-target-reopen"),r=o.find(".js-note-target-close");i.val().trim().length>0?(n=s.attr("data-alternative-text"),t=r.attr("data-alternative-text"),s.text()!==n&&s.text(n),r.text()!==t&&r.text(t),s.is(":not(.btn-comment-and-reopen)")&&s.addClass("btn-comment-and-reopen"),r.is(":not(.btn-comment-and-close)")&&r.addClass("btn-comment-and-close")):(n=s.data("originalText"),t=r.data("originalText"),s.text()!==n&&s.text(n),r.text()!==t&&r.text(t),s.is(".btn-comment-and-reopen")&&s.removeClass("btn-comment-and-reopen"),r.is(".btn-comment-and-close")&&r.removeClass("btn-comment-and-close"))}},{key:"putEditFormInPlace",value:function(e){var t=c()(this.getEditFormSelector(e)),n=e.closest(".note");t.insertAfter(n.find(".note-text"));var i=n.find(".original-note-content"),o=i.text().trim(),s=i.data("postUrl"),r=i.data("targetId"),a=i.data("targetType");this.glForm=new S.a(t.find("form"),this.enableGFM),t.find("form").attr("action","".concat(s,"?html=true")).attr("data-remote","true"),t.find(".js-form-target-id").val(r),t.find(".js-form-target-type").val(a),t.find(".js-note-text").focus().val(o),t.find(".js-md-write-button").trigger("click"),t.find(".referenced-users").hide()}},{key:"putConflictEditWarningInPlace",value:function(e,t){if(0===t.find(".js-conflict-edit-warning").length){var n='<a href="#note_'.concat(e.id,'" target="_blank" rel="noopener noreferrer">');c()('<div class="js-conflict-edit-warning alert alert-danger">\n        '.concat(Object(A.e)(Object(A.d)("Notes|This comment has changed since you started editing, please review the %{open_link}updated comment%{close_link} to ensure information is not lost"),{open_link:n,close_link:"</a>"}),"\n      </div>")).insertAfter(t.find(".note-text"))}}},{key:"updateNotesCount",value:function(e){return this.notesCountBadge.text(parseInt(this.notesCountBadge.text(),10)+e)}},{key:"onClickRetryLazyLoad",value:function(e){var t=c()(e.currentTarget);return t.prop("disabled",!0),this.loadLazyDiff(e).then((function(){t.prop("disabled",!1)}))}},{key:"loadLazyDiff",value:function(t){var n=c()(t.currentTarget).closest(".js-toggle-container");if(e.renderPlaceholderComponent(n),n.find(".js-toggle-lazy-diff").removeClass("js-toggle-lazy-diff"),0!==n.find("tbody").length){var i=n.find(".file-holder").data("linesPath"),o=n.find(".js-error-lazy-load-diff"),s=n.find(".js-success-lazy-load");return i?g.a.get(i).then((function(t){var i=t.data;s.removeClass("hidden"),o.addClass("hidden"),e.renderDiffContent(n,i)})).catch((function(){s.addClass("hidden"),o.removeClass("hidden")})):Promise.resolve()}}},{key:"toggleCommitList",value:function(e){var t=c()(e.currentTarget),n=t.siblings(".system-note-commit-list");t.find(".fa").toggleClass("fa-angle-down").toggleClass("fa-angle-up"),n.toggleClass("hide-shade")}},{key:"collapseLongCommitList",value:function(){var e=c()("#notes-list").find("li.system-note").has("ul");c.a.each(e,(function(e,t){var n=c()(t),i=n.find(".note-text").find("p").first().text().replace(":","");n.find(".note-header .system-note-message").html(i),n.find("li").length>3?(n.find(".note-text").addClass("system-note-commit-list"),n.find(".system-note-commit-list-toggler").show()):n.find(".note-text").addClass("system-note-commit-list hide-shade")}))}},{key:"addFlash",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.flashContainer=L(b.a,t)}},{key:"clearFlash",value:function(){this.flashContainer&&(this.flashContainer.style.display="none",this.flashContainer=null)}},{key:"cleanForm",value:function(e){return e.find(".js-comment-type-dropdown").removeClass("btn-group"),e.find(".dropdown-menu").remove(),e}},{key:"getFormData",value:function(e){var t=e.find(".js-note-text").val();return{formData:e.serialize(),formContent:r()(t),formAction:e.attr("action"),formContentOriginal:t}}},{key:"hasQuickActions",value:function(e){return R.test(e)}},{key:"stripQuickActions",value:function(e){return e.replace(R,"").trim()}},{key:"getQuickActionDescription",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=n.filter((function(t){return new RegExp("/".concat(t.name)).test(e)}));if(i&&i.length)if(i.length>1)t=Object(A.a)("Applying multiple commands");else{var o=i[0].description.toLowerCase();t=Object(A.e)(Object(A.a)("Applying command to %{commandDescription}"),{commandDescription:o})}else t=Object(A.a)("Applying command");return t}},{key:"createPlaceholderNote",value:function(e){var t=e.formContent,n=e.uniqueId,i=e.isDiscussionNote,o=e.currentUsername,s=e.currentUserFullname,a=e.currentUserAvatar,l=i?"discussion":"",u=c()('<li id="'.concat(n,'" class="note being-posted fade-in-half timeline-entry">\n         <div class="timeline-entry-inner">\n            <div class="timeline-icon">\n               <a href="/').concat(r()(o),'">\n                 <img class="avatar s40" src="').concat(a,'" />\n               </a>\n            </div>\n            <div class="timeline-content ').concat(l,'">\n               <div class="note-header">\n                  <div class="note-header-info">\n                     <a href="/').concat(r()(o),'">\n                       <span class="d-none d-sm-inline-block bold">').concat(r()(o),'</span>\n                       <span class="note-headline-light">').concat(r()(o),'</span>\n                     </a>\n                  </div>\n               </div>\n               <div class="note-body">\n                 <div class="note-text">\n                   <p>').concat(t,"</p>\n                 </div>\n               </div>\n            </div>\n         </div>\n      </li>"));return u.find(".d-none.d-sm-inline-block").text(r()(s)),u.find(".note-headline-light").text("@".concat(r()(o))),u}},{key:"createPlaceholderSystemNote",value:function(e){var t=e.formContent,n=e.uniqueId;return c()('<li id="'.concat(n,'" class="note system-note timeline-entry being-posted fade-in-half">\n         <div class="timeline-entry-inner">\n           <div class="timeline-content">\n             <i>').concat(t,"</i>\n           </div>\n         </div>\n       </li>"))}},{key:"postComment",value:function(e){var t=this;e.preventDefault();var n=c()(e.target);n.prop("disabled",!0);var i,s,r,a,l=n.parents("form"),u=l.find(".js-note-target-close"),d="discussion"===n.parent().find("li.droplab-item-selected").attr("id"),f=l.hasClass("js-main-target-form"),h=l.hasClass("js-discussion-note-form"),p=n.hasClass("js-comment-resolve-button"),m=this.getFormData(l),y=m.formData,b=m.formContent,w=m.formAction,k=m.formContentOriginal,j=!1;return h?r=l.parent(".discussion-notes").find(".notes"):f&&(r=c()("ul.main-notes-list")),p&&l.find(".js-comment-submit-button").disable(),a=b,this.hasQuickActions(b)&&(a=this.stripQuickActions(b),j=!0),a&&(i=o()("tempNote_"),r.append(this.createPlaceholderNote({formContent:a,uniqueId:i,isDiscussionNote:d,currentUsername:gon.current_username,currentUserFullname:gon.current_user_fullname,currentUserAvatar:gon.current_user_avatar_url}))),j&&(s=o()("tempSystemNote_"),r.append(this.createPlaceholderSystemNote({formContent:this.getQuickActionDescription(b,v.a.get(gl.GfmAutoComplete.dataSources.commands)),uniqueId:s}))),r.length&&(f?this.resetMainTargetForm(e):h&&this.removeDiscussionNoteForm(l)),u.text(u.data("originalText")),g.a.post("".concat(w,"?html=true"),y).then((function(o){var s=o.data;n.prop("disabled",!1),r.find("#".concat(i)).remove();var a=l.closest(".diff-file");if(a.length>0){var c=new CustomEvent("blur.imageDiff",{detail:e});a[0].dispatchEvent(c)}if(j&&l.find("textarea.js-note-text").trigger("clear-commands-cache.atwho"),t.clearFlashWrapper(),h){r.find(".flash-container").remove(),p&&l.attr("data-discussion-id",n.data("discussionId")).attr("data-resolve-all","true").attr("data-project-path",n.data("projectPath"));var u=0===r.length;if(t.addDiscussionNote(l,s,u),u){var d=l.find("#note_position").val();if(a.length>0&&d.length>0){var v=JSON.parse(d),m=v.x,g=v.y,y=v.width,b=v.height,w=new CustomEvent("addBadge.imageDiff",{detail:{x:m,y:g,width:y,height:b,noteId:"note_".concat(s.id),discussionId:s.discussion_id}});a[0].dispatchEvent(w)}}r.length&&r.append('<div class="flash-container" style="display: none;"></div>')}else f&&(t.addNote(l,s),t.reenableTargetFormSubmitButton(e));s.commands_changes&&t.handleQuickActions(s),l.trigger("ajax:success",[s])})).catch((function(){r.find("#".concat(i)).remove(),n.prop("disabled",!1);var o=new CustomEvent("blur.imageDiff",{detail:e}),a=l.closest(".diff-file");if(a.length&&a[0].dispatchEvent(o),j&&r.find("#".concat(s)).remove(),h&&r.length){var c=r.parent().find(".js-discussion-reply-button");t.replyToDiscussionNote(c[0]),l=r.parent().find("form")}l.find(".js-note-text").val(k),t.reenableTargetFormSubmitButton(e),t.addNoteError(l)}))}},{key:"updateComment",value:function(e){var t=this;e.preventDefault();var n=c()(e.target).parents("form"),i=n.find(".js-note-target-close"),o=n.parents(".note.is-editing"),s=o.find(".js-task-list-container").find(".note-text"),a=this.getFormData(n),l=a.formData,u=a.formContent,d=a.formAction,f=s.html();return s.html(u),o.removeClass("is-editing fade-in-full").addClass("being-posted fade-in-half"),o.find(".note-headline-meta a").html('<span class="spinner align-text-bottom"></span>'),g.a.post("".concat(d,"?html=true"),l).then((function(e){var n=e.data;t.updateNote(n,o)})).catch((function(){s.html(r()(f)),o.removeClass("being-posted fade-in"),o.find(".spinner").remove(),t.updateNoteError()})),i.text(i.data("originalText"))}}],[{key:"initCommentTypeToggle",value:function(e){var t=e.querySelector(".js-comment-type-dropdown .dropdown-toggle"),n=e.querySelector(".js-comment-type-dropdown .dropdown-menu"),i=e.querySelector("#note_type"),o=e.querySelector(".js-comment-type-dropdown .js-comment-submit-button"),s=e.querySelector(".js-note-target-close"),r=e.querySelector(".js-note-target-reopen");new _({dropdownTrigger:t,dropdownList:n,noteTypeInput:i,submitButton:o,closeButton:s,reopenButton:r}).initDroplab()}},{key:"updateNoteTargetSelector",value:function(e){var t=Object(y.d)(),n=Boolean(t&&e.filter("#".concat(t)).length>0);e.toggleClass("target",n)}},{key:"renderPlaceholderComponent",value:function(e){var t=e.find(".js-code-placeholder").get(0);new h.default({el:t,components:{GlSkeletonLoading:p.a},render:function(e){return e("gl-skeleton-loading")}})}},{key:"renderDiffContent",value:function(e,t){var n=t.discussion_html,i=c()(n).find(".line_holder");i.addClass("fade-in"),e.find(".diff-content > table > tbody").prepend(i);var o=e.find(".file-holder");e.find(".line-holder-placeholder").remove(),Object(m.a)(o)}},{key:"isNewNote",value:function(e,t){return-1===c.a.inArray(e.id,t)}},{key:"isUpdatedNote",value:function(e,t){return F(e.note.trim())!==F(t.find(".original-note-content").first().text().trim())}},{key:"checkMergeRequestStatus",value:function(){"merge_requests"===Object(N.l)(1)&&gl.mrWidget&&gl.mrWidget.checkStatus()}},{key:"animateAppendNote",value:function(e,t){var n=c()(e);return n.addClass("fade-in-full").renderGFM(),t.append(n),n}},{key:"animateUpdateNote",value:function(e,t){var n=c()(e);return n.addClass("fade-in").renderGFM(),t.replaceWith(n),n}}]),e}();window.Notes=q},681:function(e,t,n){(function(t){window,e.exports=function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,n){var i,o,s,r,a=[].indexOf;i=function(e){return Array.prototype.slice.apply(e)},s=function(e,t){for(;e&&!e.classList.contains(t);)e=e.parentNode;return e},r=function(e,t){var n;return"function"==typeof Event?(n=new Event(e,{bubbles:!0,cancelable:!0})).detail=t:(n=document.createEvent("CustomEvent")).initCustomEvent(e,!0,!0,t),n},o=function(){class e{constructor(e){this.el=e,this.container=s(this.el,"js-task-list-container"),this.field=this.container.querySelector(".js-task-list-field"),this.container.addEventListener("change",e=>{if(e.target.classList.contains("task-list-item-checkbox"))return this.updateTaskList(e.target)}),this.enable()}enable(){var e;if(this.container.querySelectorAll(".js-task-list-field").length>0)return i(this.container.querySelectorAll(".task-list-item")).forEach((function(e){return e.classList.add("enabled")})),i(this.container.querySelectorAll(".task-list-item-checkbox")).forEach((function(e){return e.disabled=!1})),this.container.classList.add("is-task-list-enabled"),e=r("tasklist:enabled"),this.container.dispatchEvent(e)}disable(){var e;return i(this.container.querySelectorAll(".task-list-item")).forEach((function(e){return e.classList.remove("enabled")})),i(this.container.querySelectorAll(".task-list-item-checkbox")).forEach((function(e){return e.disabled=!0})),this.container.classList.remove("is-task-list-enabled"),e=r("tasklist:disabled"),this.container.dispatchEvent(e)}updateTaskList(t){var n,o,s,a,c,l,u;if(s=this.container.querySelectorAll(".task-list-item-checkbox"),a=1+i(s).indexOf(t),n=r("tasklist:change",{index:a,checked:t.checked}),this.field.dispatchEvent(n),!n.defaultPrevented)return({result:u,lineNumber:c,lineSource:l}=e.updateSource(this.field.value,a,t.checked,t)),this.field.value=u,n=r("change"),this.field.dispatchEvent(n),o=r("tasklist:changed",{index:a,checked:t.checked,lineNumber:c,lineSource:l}),this.field.dispatchEvent(o)}static escapePattern(e){return e.replace(/([\[\]])/g,"\\$1").replace(/\s/,"\\s").replace("x","[xX]")}static updateSource(e,t,n,i){return i.parentElement.hasAttribute("data-sourcepos")?this._updateSourcePosition(e,i,n):this._updateSourceRegex(e,t,n)}static _updateSourcePosition(e,t,n){var i,o,s,r,a;return r=e.split("\n"),a=t.parentElement.getAttribute("data-sourcepos"),s=r[(o=parseInt(a.split(":")[0]))-1],i=n?s.replace(this.incompletePattern,this.complete):s.replace(this.completePattern,this.incomplete),r[o-1]=i,{result:r.join("\n"),lineNumber:o,lineSource:s}}static _updateSourceRegex(e,t,n){var i,o,s,r,c,l,u,d;return d=e.split("\n"),i=e.replace(/\r/g,"").replace(this.itemsInParasPattern,"").split("\n"),r=0,s=!1,{result:function(){var e,f,h;for(h=[],o=e=0,f=d.length;e<f;o=++e)c=d[o],s?c.match(this.endFencesPattern)&&(s=!1):c.match(this.startFencesPattern)?s=!0:a.call(i,c)>=0&&c.trim().match(this.itemPattern)&&(r+=1)===t&&(l=o+1,u=c,c=n?c.replace(this.incompletePattern,this.complete):c.replace(this.completePattern,this.incomplete)),h.push(c);return h}.call(this).join("\n"),lineNumber:l,lineSource:u}}}return e.incomplete="[ ]",e.complete="[x]",e.incompletePattern=RegExp(`${e.escapePattern(e.incomplete)}`),e.completePattern=RegExp(`${e.escapePattern(e.complete)}`),e.itemPattern=RegExp(`^(?:\\s*(?:>\\s*)*(?:[-+*]|(?:\\d+\\.)))\\s*(${e.escapePattern(e.complete)}|${e.escapePattern(e.incomplete)})\\s`),e.startFencesPattern=/^`{3}.*$/,e.endFencesPattern=/^`{3}$/,e.itemsInParasPattern=RegExp(`^(${e.escapePattern(e.complete)}|${e.escapePattern(e.incomplete)}).+$`,"g"),e}.call(this),void 0!==t&&(t.fn.taskList=function(e){return this.each((function(n,i){var s;if((s=t(i).data("task-list"))||(s=new o(i),t(i).data("task-list",s),e&&"enable"!==e))return s[e||"enable"]()}))}),e.exports=o}])}).call(this,n(0))},70:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));n(24),n(49),n(56),n(40),n(90),n(18),n(36),n(41);var i=n(8),o=n.n(i),s=n(9);function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var u=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),e=a(this,c(t).call(this)),o.a.bind("g p",(function(){return Object(s.a)(".shortcuts-project")})),o.a.bind("g v",(function(){return Object(s.a)(".shortcuts-project-activity")})),o.a.bind("g r",(function(){return Object(s.a)(".shortcuts-project-releases")})),o.a.bind("g f",(function(){return Object(s.a)(".shortcuts-tree")})),o.a.bind("g c",(function(){return Object(s.a)(".shortcuts-commits")})),o.a.bind("g j",(function(){return Object(s.a)(".shortcuts-builds")})),o.a.bind("g n",(function(){return Object(s.a)(".shortcuts-network")})),o.a.bind("g d",(function(){return Object(s.a)(".shortcuts-repository-charts")})),o.a.bind("g i",(function(){return Object(s.a)(".shortcuts-issues")})),o.a.bind("g b",(function(){return Object(s.a)(".shortcuts-issue-boards")})),o.a.bind("g m",(function(){return Object(s.a)(".shortcuts-merge_requests")})),o.a.bind("g w",(function(){return Object(s.a)(".shortcuts-wiki")})),o.a.bind("g s",(function(){return Object(s.a)(".shortcuts-snippets")})),o.a.bind("g k",(function(){return Object(s.a)(".shortcuts-kubernetes")})),o.a.bind("g e",(function(){return Object(s.a)(".shortcuts-environments")})),o.a.bind("g l",(function(){return Object(s.a)(".shortcuts-metrics")})),o.a.bind("i",(function(){return Object(s.a)(".shortcuts-new-issue")})),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,e),t}(n(107).a)},722:function(e,t,n){"use strict";var i=n(0),o=n.n(i),s=n(378);t.a=function(e){Object(s.b)(document.querySelector(".js-diff-files-changed"),e),o()(".js-diff-stats-dropdown").glDropdown({filterable:!0,remoteFilter:!1})}},73:function(e,t,n){"use strict";n(30),n(35),n(18),n(64);var i=n(0),o=n.n(i),s=n(32),r=(n(65),n(69),n(55),n(67),n(71));function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var c=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.projectSelectInput=o()(t),this.newItemBtn=o()(".new-project-item-link"),this.resourceType=this.newItemBtn.data("type"),this.resourceLabel=this.newItemBtn.data("label"),this.formattedText=this.deriveTextVariants(),this.groupId=this.projectSelectInput.data("groupId"),this.bindEvents(),this.initLocalStorage()}var t,i,s;return t=e,(i=[{key:"bindEvents",value:function(){var e=this;this.projectSelectInput.siblings(".new-project-item-select-button").on("click",(function(t){return e.openDropdown(t)})),this.newItemBtn.on("click",(function(t){e.getProjectFromLocalStorage()||(t.preventDefault(),e.openDropdown(t))})),this.projectSelectInput.on("change",(function(){return e.selectProject()}))}},{key:"initLocalStorage",value:function(){r.a.isLocalStorageAccessSafe()&&(this.localStorageKey=["group",this.groupId,this.formattedText.localStorageItemType,"recent-project"].join("-"),this.setBtnTextFromLocalStorage())}},{key:"openDropdown",value:function(e){n.e(239).then(n.t.bind(null,428,7)).then((function(){o()(e.currentTarget).siblings(".project-item-select").select2("open")})).catch((function(){}))}},{key:"selectProject",value:function(){var e=JSON.parse(this.projectSelectInput.val()),t={url:"".concat(e.url,"/").concat(this.projectSelectInput.data("relativePath")),name:e.name};this.setNewItemBtnAttributes(t),this.setProjectInLocalStorage(t)}},{key:"setBtnTextFromLocalStorage",value:function(){var e=this.getProjectFromLocalStorage();this.setNewItemBtnAttributes(e)}},{key:"setNewItemBtnAttributes",value:function(e){e?(this.newItemBtn.attr("href",e.url),this.newItemBtn.text("".concat(this.formattedText.defaultTextPrefix," in ").concat(e.name))):this.newItemBtn.text("Select project to create ".concat(this.formattedText.presetTextSuffix))}},{key:"getProjectFromLocalStorage",value:function(){var e=localStorage.getItem(this.localStorageKey);return JSON.parse(e)}},{key:"setProjectInLocalStorage",value:function(e){var t=JSON.stringify(e);localStorage.setItem(this.localStorageKey,t)}},{key:"deriveTextVariants",value:function(){var e=this.resourceLabel;return{localStorageItemType:"new-".concat(this.resourceType.split("_").join("-").slice(0,-1)),defaultTextPrefix:e,presetTextSuffix:this.resourceType.split("_").join(" ").slice(0,-1)}}}])&&a(t.prototype,i),s&&a(t,s),e}(),l=n(1),u=function(){o()(".ajax-project-select").each((function(e,t){var n,i=this,r=o()(t).data("simpleFilter")||!1,a=o()(t).data("select2");return this.groupId=o()(t).data("groupId"),this.userId=o()(t).data("userId"),this.includeGroups=o()(t).data("includeGroups"),this.allProjects=o()(t).data("allProjects")||!1,this.orderBy=o()(t).data("orderBy")||"id",this.withIssuesEnabled=o()(t).data("withIssuesEnabled"),this.withMergeRequestsEnabled=o()(t).data("withMergeRequestsEnabled"),this.withShared=void 0===o()(t).data("withShared")||o()(t).data("withShared"),this.includeProjectsInSubgroups=o()(t).data("includeProjectsInSubgroups")||!1,this.allowClear=o()(t).data("allowClear")||!1,n=Object(l.d)("ProjectSelect|Search for project"),this.includeGroups&&(n+=Object(l.d)("ProjectSelect| or group")),o()(t).select2({placeholder:n,minimumInputLength:0,query:function(e){var t,n=function(t){var n={results:t};return e.callback(n)};return t=i.includeGroups?function(t){return s.a.groups(e.term,{},(function(e){var i=e.concat(t);return n(i)}))}:n,i.groupId?s.a.groupProjects(i.groupId,e.term,{with_issues_enabled:i.withIssuesEnabled,with_merge_requests_enabled:i.withMergeRequestsEnabled,with_shared:i.withShared,include_subgroups:i.includeProjectsInSubgroups},t):i.userId?s.a.userProjects(i.userId,e.term,{with_issues_enabled:i.withIssuesEnabled,with_merge_requests_enabled:i.withMergeRequestsEnabled,with_shared:i.withShared,include_subgroups:i.includeProjectsInSubgroups},t):s.a.projects(e.term,{order_by:i.orderBy,with_issues_enabled:i.withIssuesEnabled,with_merge_requests_enabled:i.withMergeRequestsEnabled,membership:!i.allProjects},t)},id:function(e){return r?e.id:JSON.stringify({name:e.name,url:e.web_url})},text:function(e){return e.name_with_namespace||e.name},initSelection:function(e,t){return s.a.project(e.val()).then((function(e){var n=e.data;return t(n)}))},allowClear:this.allowClear,dropdownCssClass:"ajax-project-dropdown"}),a||r?t:new c(t)}))};t.a=function(){return n.e(239).then(n.t.bind(null,428,7)).then(u).catch((function(){}))}},761:function(e,t,n){"use strict";var i=n(550);t.a=function(){var e=document.querySelector(".js-notes-data"),t=JSON.parse(e.innerHTML),n=t.notesUrl,o=t.notesIds,s=t.now,r=t.diffView,a=t.enableGFM;i.a.initialize(n,o,s,r,a)}},804:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));n(40),n(18),n(36),n(41),n(999);function i(){var e=(gon.sourcegraph||{}).url;if(e){var t,n,i=new URL("/assets/webpack/sourcegraph/",window.location.href),o=new URL("scripts/integration.bundle.js",i).href;window.SOURCEGRAPH_ASSETS_URL=i.href,window.SOURCEGRAPH_URL=e,window.SOURCEGRAPH_INTEGRATION="gitlab-integration",t=o,(n=document.createElement("script")).type="application/javascript",n.src=t,n.defer=!0,document.head.appendChild(n)}}},88:function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));n(42),n(89);var i=n(0),o=n.n(i),s=n(51),r=n.n(s),a=n(1),c=n(33);n(28),n(78),n(40),n(46),n(129),n(35),n(77),n(18),n(36),n(41);var l=function(e){return e.reduce((function(e,t){var n=t.name,i=t.value;return Object.assign(e,function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},n,i))}),{})},u=n(11),d=n(14),f=n(73);function h(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var p=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var t=o()("ul.clone-options-dropdown"),n=o()("#project_clone"),i=o()(".js-git-clone-holder .js-clone-dropdown-label"),s=document.querySelector(".js-mobile-git-clone .js-clone-dropdown-label"),a=i.text().trim();a.length>0&&o()("a:contains('".concat(a,"')"),t).addClass("is-active"),o()("a",t).on("click",(function(e){e.preventDefault();var i=o()(e.currentTarget),r=i.attr("href"),a=i.data("cloneType");o()(".is-active",t).removeClass("is-active"),o()('a[data-clone-type="'.concat(a,'"]')).each((function(){var e=o()(this),t=e.find(".dropdown-menu-inner-title").text(),n=e.closest(".project-clone-holder").find(".js-clone-dropdown-label");e.toggleClass("is-active"),n.text(t)})),s?s.dataset.clipboardText=r:n.val(r),o()(".js-git-empty .js-clone").text(r)})),e.initRefSwitcher(),o()(".project-refs-select").on("change",(function(){return o()(this).parents("form").submit()})),o()(".hide-no-ssh-message").on("click",(function(e){return r.a.set("hide_no_ssh_message","false"),o()(this).parents(".no-ssh-key-message").remove(),e.preventDefault()})),o()(".hide-no-password-message").on("click",(function(e){return r.a.set("hide_no_password_message","false"),o()(this).parents(".no-password-message").remove(),e.preventDefault()})),o()(".hide-auto-devops-implicitly-enabled-banner").on("click",(function(e){var t=o()(this).data("project-id"),n="hide_auto_devops_implicitly_enabled_banner_".concat(t);return r.a.set(n,"false"),o()(this).parents(".auto-devops-implicitly-enabled-banner").remove(),e.preventDefault()})),e.projectSelectDropdown()}var t,n,i;return t=e,i=[{key:"projectSelectDropdown",value:function(){Object(f.a)(),o()(".project-item-select").on("click",(function(t){return e.changeProject(o()(t.currentTarget).val())}))}},{key:"changeProject",value:function(e){return window.location=e}},{key:"initRefSwitcher",value:function(){var e=document.createElement("li"),t=document.createElement("a");return t.href="#",o()(".js-project-refs-dropdown").each((function(){var n,i,s,r=o()(this),f=r.data("selected"),h=r.data("fieldName"),p=Boolean(r.data("visit")),v=r.closest("form"),m=v.attr("action"),g=Object(c.h)((n=v[0],i=new FormData(n),s=Array.from(i.keys()).map((function(e){var t=i.getAll(e);return{name:e,value:1===(t=t.filter((function(e){return e}))).length?t[0]:t}})),l(s)),m);return r.glDropdown({data:function(e,t){u.a.get(r.data("refsUrl"),{params:{ref:r.data("ref"),search:e}}).then((function(e){var n=e.data;return t(n)})).catch((function(){return Object(d.a)(Object(a.a)("An error occurred while getting projects"))}))},selectable:!0,filterable:!0,filterRemote:!0,filterByText:!0,inputFieldName:r.data("inputFieldName"),fieldName:h,renderRow:function(n){var i,o,s,r=e.cloneNode(!1),a=t.cloneNode(!1);return n===f&&(a.className="is-active"),a.textContent=n,a.dataset.ref=n,n.length>0&&p&&(a.href=Object(c.h)((s=n,(o=h)in(i={})?Object.defineProperty(i,o,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[o]=s,i),g)),r.appendChild(a),r},id:function(e,t){return t.attr("data-ref")},toggleLabel:function(e,t){return t.text().trim()},clicked:function(e){var t=e.e;p||t.preventDefault()}})}))}}],(n=null)&&h(t.prototype,n),i&&h(t,i),e}()}},[[2280,1,0,2,3]]]);
//# sourceMappingURL=pages.projects.commit.show.847375cf.chunk.js.map