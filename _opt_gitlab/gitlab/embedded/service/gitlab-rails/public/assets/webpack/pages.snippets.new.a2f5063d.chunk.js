(this.webpackJsonp=this.webpackJsonp||[]).push([[224],{1151:function(e,t,n){"use strict";var a=n(0),i=n.n(a),o=n(208),r=n(218);t.a=function(){new o.a(i()(".snippet-form"),{members:!1,issues:!1,mergeRequests:!1,epics:!1,milestones:!1,labels:!1,snippets:!1}),new r.a}},208:function(e,t,n){"use strict";n.d(t,"a",(function(){return C}));n(42),n(26),n(77),n(38),n(27);var a=n(0),i=n.n(a),o=n(157),r=n.n(o),s=n(164),l=(n(28),n(85),n(46),n(55),n(91),n(67),n(233),n(94)),u=n.n(l),c=n(20),d=n.n(c);n(441),n(24),n(49),n(56),n(78),n(104),n(40),n(65),n(145),n(18),n(68),n(122),n(36),n(89),n(41);function f(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function h(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var v=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.data=t,this.columnWidths=[],this.rows=[],this.tableFound=this.parseTable()}var t,n,a;return t=e,(n=[{key:"isTable",value:function(){return this.tableFound}},{key:"convertToTableMarkdown",value:function(){var e=this;this.calculateColumnWidths();var t=this.rows.map((function(t){return"| ".concat(t.map((function(t,n){return e.formatColumn(t,n)})).join(" | ")," |")}));return t.splice(1,0,this.generateHeaderBreak()),t.join("\n")}},{key:"parseTable",value:function(){if(!this.data.types.includes("text/html")||!this.data.types.includes("text/plain"))return!1;var e=this.data.getData("text/html");if(this.doc=(new DOMParser).parseFromString(e,"text/html"),1!==this.doc.querySelectorAll("table").length)return!1;var t=this.data.getData("text/plain").trim().split(/[\n\u0085\u2028\u2029]|\r\n?/g);return this.doc.querySelectorAll("tr").length===t.length&&(this.rows=t.map((function(e){return e.split("\t")})),this.normalizeRows(),!!this.columnCountsMatch())}},{key:"normalizeRows",value:function(){var e=this.rows.map((function(e){return e.length})),t=Math.max.apply(Math,h(e));this.rows.forEach((function(e){for(;e.length<t;)e.push("")}))}},{key:"calculateColumnWidths",value:function(){var e=this;this.columnWidths=this.rows[0].map((function(t,n){return function(e,t){return Math.max.apply(Math,h(e.map((function(e){return e[t].length}))))}(e.rows,n)}))}},{key:"columnCountsMatch",value:function(){var e=this.rows[0].length,t=0;return this.doc.querySelectorAll("table tr").forEach((function(e){t=Math.max(e.cells.length,t)})),e===t}},{key:"formatColumn",value:function(e,t){return e+Array(this.columnWidths[t]-e.length+1).join(" ")}},{key:"generateHeaderBreak",value:function(){var e=this,t=this.columnWidths.map((function(t,n){return Array(e.columnWidths[n]+3).join("-")}));return"|".concat(t.join("|"),"|")}}])&&f(t.prototype,n),a&&f(t,a),e}(),p=n(178),m=n(11),g=n(1);function b(e){return!e||d.a.isString(e)?e:e.message}function y(e){var t,n,a,o,r,s,l,c=e.find(".button-attach-file"),f=e.find(".attaching-file-message"),h=e.find(".button-cancel-uploading-files"),y=e.find(".retry-uploading-link"),w=e.find(".uploading-progress"),k=e.find(".uploading-error-container"),C=e.find(".uploading-error-message"),x=e.find(".uploading-progress-container"),j=e.data("uploads-path")||window.uploads_path||null,z=gon.max_file_size||10,E=e.find(".js-gfm-input");E.wrap('<div class="div-dropzone"></div>'),E.on("paste",(function(e){return t(e)}));var O=E.closest(".md-area");e.setupMarkdownPreview();var D=e.find(".div-dropzone");if(D.parent().addClass("div-dropzone-wrapper"),D.append('<div class="div-dropzone-hover"></div>'),D.find(".div-dropzone-hover").append('<i class="fa fa-paperclip div-dropzone-icon"></i>'),!j)return D.addClass("js-invalid-dropzone"),null;var S=D.dropzone({url:j,dictDefaultMessage:"",clickable:!0,paramName:"file",maxFilesize:z,uploadMultiple:!1,headers:p.a.headers,previewContainer:!1,processing:function(){return i()(".div-dropzone-alert").alert("close")},dragover:function(){O.addClass("is-dropzone-hover"),e.find(".div-dropzone-hover").css("opacity",.7)},dragleave:function(){O.removeClass("is-dropzone-hover"),e.find(".div-dropzone-hover").css("opacity",0)},drop:function(){O.removeClass("is-dropzone-hover"),e.find(".div-dropzone-hover").css("opacity",0),E.focus()},success:function(e,t){var i=this.getQueuedFiles().length+this.getUploadingFiles().length,o=i>=1;n(t.link.markdown,o),i||c.removeClass("hide"),a(t.link.url)},error:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(g.a)("Attaching the file failed."),n=arguments.length>2?arguments[2]:void 0,a=b(t||n.responseText);k.removeClass("hide"),C.html(a),c.addClass("hide"),h.addClass("hide")},totaluploadprogress:function(e){o(this.files,f),w.text("".concat(Math.round(e),"%"))},sending:function(){c.addClass("hide"),k.addClass("hide"),x.removeClass("hide"),h.removeClass("hide")},removedfile:function(){c.removeClass("hide"),h.addClass("hide"),x.addClass("hide"),k.addClass("hide")},queuecomplete:function(){i()(".dz-preview").remove(),i()(".markdown-area").trigger("input"),x.addClass("hide"),h.addClass("hide")}}),A=i()(S[0]).children("textarea");h.on("click",(function(e){e.preventDefault(),e.stopPropagation(),u.a.forElement(D.get(0)).removeAllFiles(!0)})),y.on("click",(function(e){var t=u.a.forElement(e.target.closest(".js-main-target-form").querySelector(".div-dropzone")),n=t.files;e.preventDefault(),t.removeAllFiles(!0),n.map((function(e){var n=e;return n.status===u.a.ERROR&&(n.status=void 0,n.accepted=void 0),t.addFile(n)}))})),t=function(e){var t=e.originalEvent,a=t.clipboardData;if(a&&a.items){var i=new v(a);if(i.isTable()){e.preventDefault();var o=i.convertToTableMarkdown();n(o)}else{var u=r(t);if(u){e.preventDefault();var c=s(t)||"image.png",d="{{".concat(c,"}}");return n(d),l(u.getAsFile(),c)}}}},r=function(e){for(var t=0;t<e.clipboardData.items.length;){var n=e.clipboardData.items[t];if(-1!==n.type.indexOf("image"))return n;t+=1}return!1},n=function(e,t){var n=e;t&&(n+="\n\n");var a=A.get(0),o=a.selectionStart,r=a.selectionEnd,s=i()(A).val().length,l=i()(A).val().substring(0,o),u=i()(A).val().substring(r,s);return i()(A).val(l+n+u),a.setSelectionRange(o+n.length,r+n.length),a.style.height="".concat(a.scrollHeight,"px"),E.get(0).dispatchEvent(new Event("input")),E.trigger("input")},a=function(t){i()(e).append('<input type="hidden" name="files[]" value="'.concat(d.a.escape(t),'">'))},s=function(e){var t;return window.clipboardData&&window.clipboardData.getData?t=window.clipboardData.getData("Text"):e.clipboardData&&e.clipboardData.getData&&(t=e.clipboardData.getData("text/plain")),(t=t.split("\r"))[0]};var M=function(){return x.addClass("hide")};return l=function(t,n){var a=new FormData;a.append("file",t,n),x.removeClass("hide"),e.find(".div-dropzone-alert").alert("close"),m.a.post(j,a).then((function(e){var t=e.data.link.markdown;!function(e,t){var n=i()(A),a=n.get(0),o=a.selectionStart,r=a.selectionEnd,s="{{".concat(e,"}}");n.val((function(e,n){return n.replace(s,t)})),a.setSelectionRange(o-s.length+t.length,r-s.length+t.length),n.trigger("change")}(n,t),M()})).catch((function(e){var t;t=e.response.data.message,k.removeClass("hide"),C.html(t),M()}))},o=function(e,t){var n=e.filter((function(e){return"uploading"===e.status||"queued"===e.status})).length,a=Object(g.c)("Attaching a file","Attaching %d files",n);t.text("".concat(a," -"))},e.find(".markdown-selector").click((function(e){e.preventDefault(),i()(this).closest(".gfm-form").find(".div-dropzone").click(),E.focus()})),D.get(0)?u.a.forElement(D.get(0)):null}u.a.autoDiscover=!1;var w=n(199);function k(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var C=function(){function e(t){var n=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.form=t,this.textarea=this.form.find("textarea.js-gfm-input"),this.enableGFM=Object.assign({},s.b,a);var i=gl.GfmAutoComplete&&gl.GfmAutoComplete.dataSources||{};Object.keys(this.enableGFM).forEach((function(e){"emojis"!==e&&(n.enableGFM[e]=Boolean(i[e]))})),this.destroy(),this.setupForm(),this.form.data("glForm",this)}var t,n,a;return t=e,(n=[{key:"destroy",value:function(){this.clearEventListeners(),this.autoComplete&&this.autoComplete.destroy(),this.form.data("glForm",null)}},{key:"setupForm",value:function(){var e=this.form.is(":not(.gfm-form)");this.form.removeClass("js-new-note-form"),e&&(this.form.find(".div-dropzone").remove(),this.form.addClass("gfm-form"),gl.utils.disableButtonIfEmptyField(this.form.find(".js-note-text"),this.form.find(".js-comment-button, .js-note-new-discussion")),this.autoComplete=new s.a(gl.GfmAutoComplete&&gl.GfmAutoComplete.dataSources),this.autoComplete.setup(this.form.find(".js-gfm-input"),this.enableGFM),y(this.form),r()(this.textarea)),this.addEventListeners(),Object(w.b)(this.form),this.form.show(),this.isAutosizeable&&this.setupAutosize()}},{key:"setupAutosize",value:function(){var e=this;this.textarea.off("autosize:resized").on("autosize:resized",this.setHeightData.bind(this)),this.textarea.off("mouseup.autosize").on("mouseup.autosize",this.destroyAutosize.bind(this)),setTimeout((function(){r()(e.textarea),e.textarea.css("resize","vertical")}),0)}},{key:"setHeightData",value:function(){this.textarea.data("height",this.textarea.outerHeight())}},{key:"destroyAutosize",value:function(){var e=this.textarea.outerHeight();this.textarea.data("height")!==e&&(r.a.destroy(this.textarea),this.textarea.data("height",e),this.textarea.outerHeight(e),this.textarea.css("max-height",window.outerHeight))}},{key:"clearEventListeners",value:function(){this.textarea.off("focus"),this.textarea.off("blur"),Object(w.c)(this.form)}},{key:"addEventListeners",value:function(){this.textarea.on("focus",(function(){i()(this).closest(".md-area").addClass("is-focused")})),this.textarea.on("blur",(function(){i()(this).closest(".md-area").removeClass("is-focused")}))}}])&&k(t.prototype,n),a&&k(t,a),e}()},218:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));n(42);var a=n(0),i=n.n(a),o=(n(439),n(94)),r=n.n(o),s=n(8),l=n.n(s);n(440);function u(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}r.a.autoDiscover=!1;var c=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.active_backdrop=null,this.active_textarea=null,i()(document).on("click",".js-zen-enter",(function(e){return e.preventDefault(),i()(e.currentTarget).trigger("zen_mode:enter")})),i()(document).on("click",".js-zen-leave",(function(e){return e.preventDefault(),i()(e.currentTarget).trigger("zen_mode:leave")})),i()(document).on("zen_mode:enter",(function(e){t.enter(i()(e.target).closest(".md-area").find(".zen-backdrop"))})),i()(document).on("zen_mode:leave",(function(){t.exit()})),i()(document).on("keydown",(function(e){if(27===e.keyCode)return e.preventDefault(),i()(document).trigger("zen_mode:leave")}))}var t,n,a;return t=e,(n=[{key:"enter",value:function(e){l.a.pause(),this.active_backdrop=i()(e),this.active_backdrop.addClass("fullscreen"),this.active_textarea=this.active_backdrop.find("textarea"),this.active_textarea.removeAttr("style"),this.active_textarea.focus()}},{key:"exit",value:function(){if(this.active_textarea){l.a.unpause(),this.active_textarea.closest(".zen-backdrop").removeClass("fullscreen"),this.scrollTo(this.active_textarea),this.active_textarea=null,this.active_backdrop=null;var e=i()(".div-dropzone");e&&!e.hasClass("js-invalid-dropzone")&&r.a.forElement(".div-dropzone").enable()}}},{key:"scrollTo",value:function(e){return i.a.scrollTo(e,0,{offset:-150})}}])&&u(t.prototype,n),a&&u(t,a),e}()},233:function(e,t,n){"use strict";var a=n(108),i=n(348);a({target:"String",proto:!0,forced:n(349)("link")},{link:function(e){return i(this,"a","href",e)}})},2448:function(e,t,n){n(105),e.exports=n(2449)},2449:function(e,t,n){"use strict";n.r(t);var a=n(732),i=n(1151);document.addEventListener("DOMContentLoaded",(function(){Object(a.a)(),Object(i.a)()}))},732:function(e,t,n){"use strict";n(24),n(28),n(42),n(26),n(85),n(35),n(50),n(58),n(38),n(55),n(67),n(27);var a=n(245),i=n(443),o=n(684),r=n(685);function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var c=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.editorEl=null,this.blobContent="",this.blobPath="",this.instance=null,this.model=null,this.options=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({extraEditorClassName:"gl-editor-lite"},o.b,{},t),e.setupMonacoTheme()}var t,n,c;return t=e,c=[{key:"setupMonacoTheme",value:function(){var e,t=(null===(e=window.gon)||void 0===e?void 0:e.user_color_scheme)||i.a,n=i.b.find((function(e){return e.name===t}));n&&a.editor.defineTheme(t,n.data),a.editor.setTheme(n?t:i.a)}}],(n=[{key:"createInstance",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.el,n=void 0===t?void 0:t,i=e.blobPath,o=void 0===i?"":i,s=e.blobContent,l=void 0===s?"":s;n&&(this.editorEl=n,this.blobContent=l,this.blobPath=o,Object(r.a)(this.editorEl),this.model=a.editor.createModel(this.blobContent,void 0,new a.Uri("gitlab",!1,this.blobPath)),a.editor.onDidCreateEditor(this.renderEditor.bind(this)),this.instance=a.editor.create(this.editorEl,this.options),this.instance.setModel(this.model))}},{key:"dispose",value:function(){return this.instance&&this.instance.dispose()}},{key:"renderEditor",value:function(){delete this.editorEl.dataset.editorLoading}},{key:"updateModelLanguage",value:function(e){if(e!==this.blobPath){this.blobPath=e;var t=".".concat(e.split(".").pop()),n=a.languages.getLanguages().find((function(e){return-1!==e.extensions.indexOf(t)})),i=n?n.id:"plaintext";a.editor.setModelLanguage(this.model,i)}}},{key:"getValue",value:function(){return this.model.getValue()}}])&&u(t.prototype,n),c&&u(t,c),e}();function d(e){var t,n,a,i,o=e.el,r=e.blobPath,s=e.blobContent;if(!o)throw new Error('"el" parameter is required to initialize Editor');return(null===(t=window)||void 0===t?void 0:null===(n=t.gon)||void 0===n?void 0:null===(a=n.features)||void 0===a?void 0:a.monacoSnippets)?(i=new c).createInstance({el:o,blobPath:r,blobContent:s}):i=ace.edit(o),i}n(78),n(36);var f,h=function(e){return e.classList.add("d-none")},v=function(e){return e.classList.remove("d-none")},p=function(e){var t=e.querySelector(".js-collapsed"),n=e.querySelector(".js-expanded"),a=t.querySelector("textarea,input,select"),i=n.querySelector("textarea,input,select"),o=e.closest("form");o.addEventListener("focusin",(function(o){o.target===a?(h(t),v(n),i.focus()):e.contains(o.target)||i.value||(h(n),v(t))}))},m=function(){var e,t,n,a,i,o,r;(null===(e=window)||void 0===e?void 0:null===(t=e.gon)||void 0===t?void 0:null===(n=t.features)||void 0===n?void 0:n.monacoSnippets)?(a=document.getElementById("editor"),i=document.querySelector(".snippet-file-content"),o=document.querySelector(".js-snippet-file-name"),r=document.querySelector(".snippet-form-holder form"),f=d({el:a,blobPath:o.value,blobContent:i.value}),o.addEventListener("change",(function(){f.updateModelLanguage(o.value)})),r.addEventListener("submit",(function(){i.value=f.getValue()}))):function(){var e=document.getElementById("editor"),t=document.querySelector(".snippet-form-holder form"),n=document.querySelector(".snippet-file-content");f=d({el:e}),t.addEventListener("submit",(function(){n.value=f.getValue()}))}(),Array.from(document.querySelectorAll(".js-collapsible-input")).forEach(p)};t.a=function(){m()}}},[[2448,1,0,3,19]]]);
//# sourceMappingURL=pages.snippets.new.a2f5063d.chunk.js.map