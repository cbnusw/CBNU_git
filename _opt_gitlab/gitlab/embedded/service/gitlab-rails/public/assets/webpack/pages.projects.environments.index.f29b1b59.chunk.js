(this.webpackJsonp=this.webpackJsonp||[]).push([[149],{2289:function(t,e,n){n(105),n(113),t.exports=n(2464)},2464:function(t,e,n){"use strict";n.r(e);n(24),n(28),n(26),n(50),n(58),n(38),n(27);var o=n(17),a=n(1243),r=n(553),i={props:{canaryDeploymentFeatureId:{type:String,required:!1,default:""},showCanaryDeploymentCallout:{type:Boolean,required:!1,default:!1},userCalloutsPath:{type:String,required:!1,default:""},lockPromotionSvgPath:{type:String,required:!1,default:""},helpCanaryDeploymentsPath:{type:String,required:!1,default:""}},metods:{toggleDeployBoard:function(){}}},s=n(14),l=n(1),c={name:"EnvironmentsEmptyState",props:{newPath:{type:String,required:!0},canCreateEnvironment:{type:Boolean,required:!0},helpPath:{type:String,required:!0}}},p=n(4),d=Object(p.a)(c,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"empty-state"},[n("div",{staticClass:"text-content"},[n("h4",{staticClass:"blank-state-title js-blank-state-title"},[t._v("\n      "+t._s(t.s__("Environments|You don't have any environments right now"))+"\n    ")]),t._v(" "),n("p",{staticClass:"blank-state-text"},[t._v("\n      "+t._s(t.s__("Environments|Environments are places where\n      code gets deployed, such as staging or production."))+"\n      "),n("a",{attrs:{href:t.helpPath}},[t._v(" "+t._s(t.s__("Environments|Read more about environments"))+" ")])]),t._v(" "),n("div",{staticClass:"text-center"},[t.canCreateEnvironment?n("a",{staticClass:"btn btn-success js-new-environment-button",attrs:{href:t.newPath}},[t._v("\n        "+t._s(t.s__("Environments|New environment"))+"\n      ")]):t._e()])])])}),[],!1,null,null,null).exports,m=n(352),u=n(1244),v=n(549),h=n(301),f=n(2535),y=n(2533),g=n(2536),b=n(0),_=n.n(b),E=n(828),C=n(1240),w=n.n(C),P=n(45),S={components:{GlButton:r.a,Icon:P.a},directives:{GlTooltip:E.a},props:{text:{type:String,required:!1,default:""},container:{type:String,required:!1,default:""},cssClasses:{type:String,required:!1,default:""},modalId:{type:String,required:!1,default:""},target:{type:String,required:!1,default:""},title:{type:String,required:!0},tooltipPlacement:{type:String,required:!1,default:"top"},tooltipContainer:{type:String,required:!1,default:null}},copySuccessText:Object(l.a)("Copied"),computed:{modalDomId:function(){return this.modalId?"#".concat(this.modalId):""}},mounted:function(){var t=this;this.$nextTick((function(){t.clipboard=new w.a(t.$el,{container:document.querySelector("".concat(t.modalDomId," div.modal-content"))||document.getElementById(t.container)||document.body}),t.clipboard.on("success",(function(e){t.updateTooltip(e.trigger),t.$emit("success",e),e.clearSelection(),_()(e.trigger).blur()})).on("error",(function(e){return t.$emit("error",e)}))}))},destroyed:function(){this.clipboard&&this.clipboard.destroy()},methods:{updateTooltip:function(t){var e=_()(t),n=e.data("originalTitle");e.tooltip&&(_()(".tooltip").remove(),e.attr("title",this.$options.copySuccessText),e.tooltip("_fixTitle"),e.tooltip("show"),e.attr("title",n),e.tooltip("_fixTitle"))}}},O=Object(p.a)(S,(function(){var t=this.$createElement,e=this._self._c||t;return e("gl-button",{directives:[{name:"gl-tooltip",rawName:"v-gl-tooltip",value:{placement:this.tooltipPlacement,container:this.tooltipContainer},expression:"{ placement: tooltipPlacement, container: tooltipContainer }"}],class:this.cssClasses,attrs:{"data-clipboard-target":this.target,"data-clipboard-text":this.text,title:this.title}},[this._t("default",[e("icon",{attrs:{name:"copy-to-clipboard"}})])],2)}),[],!1,null,null,null).exports,k={components:{GlButton:r.a,GlLink:h.a,GlModal:f.a,GlSprintf:y.a,ModalCopyButton:O},directives:{"gl-modal":g.a},instructionText:{step1:Object(l.d)("EnableReviewApp|%{stepStart}Step 1%{stepEnd}. Ensure you have Kubernetes set up and have a base domain for your %{linkStart}cluster%{linkEnd}."),step2:Object(l.d)("EnableReviewApp|%{stepStart}Step 2%{stepEnd}. Copy the following snippet:"),step3:Object(l.d)("EnableReviewApp|%{stepStart}Step 3%{stepEnd}. Add it to the project %{linkStart}gitlab-ci.yml%{linkEnd} file.")},modalInfo:{closeText:Object(l.d)("EnableReviewApp|Close"),copyToClipboardText:Object(l.d)("EnableReviewApp|Copy snippet text"),copyString:'deploy_review:\n  stage: deploy\n  script:\n    - echo "Deploy a review app"\n  environment:\n    name: review/$CI_COMMIT_REF_NAME\n    url: https://$CI_ENVIRONMENT_SLUG.example.com\n  only:\n    - branches\n  except:\n    - master',id:"enable-review-app-info",title:Object(l.d)("ReviewApp|Enable Review App")}},j=Object(p.a)(k,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("gl-button",{directives:[{name:"gl-modal",rawName:"v-gl-modal",value:t.$options.modalInfo.id,expression:"$options.modalInfo.id"}],staticClass:"js-enable-review-app-button",attrs:{variant:"info",category:"secondary",type:"button"}},[t._v("\n    "+t._s(t.s__("Environments|Enable review app"))+"\n  ")]),t._v(" "),n("gl-modal",{staticClass:"text-2 ws-normal",attrs:{"modal-id":t.$options.modalInfo.id,title:t.$options.modalInfo.title,size:"lg","ok-only":"","ok-variant":"light","ok-title":t.$options.modalInfo.closeText}},[n("p",[n("gl-sprintf",{attrs:{message:t.$options.instructionText.step1},scopedSlots:t._u([{key:"step",fn:function(e){var o=e.content;return[n("strong",[t._v(t._s(o))])]}},{key:"link",fn:function(e){var o=e.content;return[n("gl-link",{attrs:{href:"https://docs.gitlab.com/ee/user/project/clusters/add_remove_clusters.html",target:"_blank"}},[t._v(t._s(o))])]}}])})],1),t._v(" "),n("div",[n("p",[n("gl-sprintf",{attrs:{message:t.$options.instructionText.step2},scopedSlots:t._u([{key:"step",fn:function(e){var o=e.content;return[n("strong",[t._v(t._s(o))])]}}])})],1),t._v(" "),n("div",{staticClass:"flex align-items-start"},[n("pre",{staticClass:"w-100"},[t._v(" "+t._s(t.$options.modalInfo.copyString)+" ")]),t._v(" "),n("modal-copy-button",{attrs:{title:t.$options.modalInfo.copyToClipboardText,text:t.$options.modalInfo.copyString,"modal-id":t.$options.modalInfo.id,"css-classes":"border-0"}})],1)]),t._v(" "),n("p",[n("gl-sprintf",{attrs:{message:t.$options.instructionText.step3},scopedSlots:t._u([{key:"step",fn:function(e){var o=e.content;return[n("strong",[t._v(t._s(o))])]}},{key:"link",fn:function(e){var o=e.content;return[n("gl-link",{attrs:{href:"blob/master/.gitlab-ci.yml",target:"_blank"}},[t._v(t._s(o))])]}}])})],1)])],1)}),[],!1,null,null,null).exports,x=n(1250),T=(n(35),n(20)),I=n.n(T),$={name:"ConfirmRollbackModal",components:{GlModal:f.a},props:{environment:{type:Object,required:!0}},computed:{modalTitle:function(){var t=this.environment.isLastDeployment?Object(l.d)("Environments|Re-deploy environment %{name}?"):Object(l.d)("Environments|Rollback environment %{name}?");return Object(l.e)(t,{name:I.a.escape(this.environment.name)})},commitShortSha:function(){var t=this.environment.last_deployment;return this.commitData(t,"short_id")},commitUrl:function(){var t=this.environment.last_deployment;return this.commitData(t,"commit_path")},commitTitle:function(){var t=this.environment.last_deployment;return this.commitData(t,"title")},modalText:function(){var t='<a class="commit-sha mr-0" href="'.concat(I.a.escape(this.commitUrl),'">'),e=I.a.escape(this.commitShortSha),n=I.a.escape(this.name),o=this.environment.isLastDeployment?Object(l.d)("Environments|This action will relaunch the job for commit %{linkStart}%{commitId}%{linkEnd}, putting the environment in a previous version. Are you sure you want to continue?"):Object(l.d)("Environments|This action will run the job defined by %{name} for commit %{linkStart}%{commitId}%{linkEnd} putting the environment in a previous version. You can revert it by re-deploying the latest version of your application. Are you sure you want to continue?");return Object(l.e)(o,{commitId:e,linkStart:t,linkEnd:"</a>",name:n},!1)},modalActionText:function(){return this.environment.isLastDeployment?Object(l.d)("Environments|Re-deploy"):Object(l.d)("Environments|Rollback")}},methods:{onOk:function(){m.a.$emit("rollbackEnvironment",this.environment)},commitData:function(t,e){return t&&t.commit?t.commit[e]:""}}},D={components:{ConfirmRollbackModal:Object(p.a)($,(function(){var t=this.$createElement,e=this._self._c||t;return e("gl-modal",{attrs:{title:this.modalTitle,"modal-id":"confirm-rollback-modal","ok-title":this.modalActionText,"ok-variant":"danger"},on:{ok:this.onOk}},[e("p",{domProps:{innerHTML:this._s(this.modalText)}})])}),[],!1,null,null,null).exports,emptyState:d,EnableReviewAppButton:j,GlButton:r.a,StopEnvironmentModal:x.a},mixins:[v.a,u.a,i],props:{endpoint:{type:String,required:!0},canCreateEnvironment:{type:Boolean,required:!0},canReadEnvironment:{type:Boolean,required:!0},newEnvironmentPath:{type:String,required:!0},helpPagePath:{type:String,required:!0},deployBoardsHelpPath:{type:String,required:!1,default:""}},created:function(){m.a.$on("toggleFolder",this.toggleFolder)},beforeDestroy:function(){m.a.$off("toggleFolder")},methods:{toggleFolder:function(t){this.store.toggleFolder(t),t.isOpen||this.fetchChildEnvironments(t,!0)},fetchChildEnvironments:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.store.updateEnvironmentProp(t,"isLoadingFolderContent",n),this.service.getFolderContent(t.folder_path).then((function(n){return e.store.setfolderContent(t,n.data.environments)})).then((function(){return e.store.updateEnvironmentProp(t,"isLoadingFolderContent",!1)})).catch((function(){Object(s.a)(Object(l.d)("Environments|An error occurred while fetching the environments.")),e.store.updateEnvironmentProp(t,"isLoadingFolderContent",!1)}))},successCallback:function(t){var e=this;this.saveData(t);var n=this.store.getOpenFolders();n.length&&n.forEach((function(t){return e.fetchChildEnvironments(t)}))}}},q=Object(p.a)(D,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("stop-environment-modal",{attrs:{environment:t.environmentInStopModal}}),t._v(" "),n("confirm-rollback-modal",{attrs:{environment:t.environmentInRollbackModal}}),t._v(" "),n("div",{staticClass:"top-area"},[n("tabs",{attrs:{tabs:t.tabs,scope:"environments"},on:{onChangeTab:t.onChangeTab}}),t._v(" "),n("div",{staticClass:"nav-controls"},[t.state.reviewAppDetails.can_setup_review_app?n("enable-review-app-button",{staticClass:"mr-2"}):t._e(),t._v(" "),t.canCreateEnvironment&&!t.isLoading?n("gl-button",{attrs:{href:t.newEnvironmentPath,category:"primary",variant:"success"}},[t._v("\n        "+t._s(t.s__("Environments|New environment"))+"\n      ")]):t._e()],1)],1),t._v(" "),n("container",{attrs:{"is-loading":t.isLoading,environments:t.state.environments,pagination:t.state.paginationInformation,"can-read-environment":t.canReadEnvironment,"canary-deployment-feature-id":t.canaryDeploymentFeatureId,"show-canary-deployment-callout":t.showCanaryDeploymentCallout,"user-callouts-path":t.userCalloutsPath,"lock-promotion-svg-path":t.lockPromotionSvgPath,"help-canary-deployments-path":t.helpCanaryDeploymentsPath,"deploy-boards-help-path":t.deployBoardsHelpPath},on:{onChangePage:t.onChangePage}},[t.isLoading||0!==t.state.environments.length?t._e():n("empty-state",{attrs:{slot:"emptyState","new-path":t.newEnvironmentPath,"help-path":t.helpPagePath,"can-create-environment":t.canCreateEnvironment},slot:"emptyState"})],1)],1)}),[],!1,null,null,null).exports,R=n(16),B=n(177);function A(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function F(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?A(Object(n),!0).forEach((function(e){L(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):A(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function L(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}o.default.use(B.a);document.addEventListener("DOMContentLoaded",(function(){return new o.default({el:"#environments-list-view",components:{environmentsComponent:q},mixins:[a.a],data:function(){var t=document.querySelector(this.$options.el).dataset;return{endpoint:t.environmentsDataEndpoint,newEnvironmentPath:t.newEnvironmentPath,helpPagePath:t.helpPagePath,deployBoardsHelpPath:t.deployBoardsHelpPath,canCreateEnvironment:Object(R.F)(t.canCreateEnvironment),canReadEnvironment:Object(R.F)(t.canReadEnvironment)}},render:function(t){return t("environments-component",{props:F({endpoint:this.endpoint,newEnvironmentPath:this.newEnvironmentPath,helpPagePath:this.helpPagePath,deployBoardsHelpPath:this.deployBoardsHelpPath,canCreateEnvironment:this.canCreateEnvironment,canReadEnvironment:this.canReadEnvironment},this.canaryCalloutProps)})}})}))}},[[2289,1,0,2,28]]]);
//# sourceMappingURL=pages.projects.environments.index.f29b1b59.chunk.js.map